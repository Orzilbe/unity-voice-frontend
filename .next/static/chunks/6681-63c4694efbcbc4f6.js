"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6681],{41008:(e,t,o)=>{o.d(t,{Av:()=>l,Ly:()=>h,bZ:()=>c,e$:()=>d,kV:()=>u,l6:()=>g,zG:()=>i});let s="https://unity-voice-backend-production-46a1.up.railway.app/api";async function a(e){let t=e.headers.get("content-type");if(console.log("\uD83D\uDCE1 Response: ".concat(e.status," ").concat(e.statusText,", Content-Type: ").concat(t)),t&&t.includes("application/json"))try{let t=await e.json();if(console.log("✅ JSON parsed successfully:",t),!e.ok){let o={status:e.status,statusText:e.statusText,message:t.message||t.error||"API request failed",responseData:t,url:e.url};throw console.error("❌ API Error (JSON):",o),o}return t}catch(t){if(!e.ok){let o={status:e.status,statusText:e.statusText,message:"Failed to parse JSON response: ".concat(t),responseData:null,url:e.url};throw console.error("❌ API Error (JSON Parse Failed):",o),o}console.warn("⚠️ JSON parse failed on successful response:",t);try{let t=await e.text();return console.log("\uD83D\uDCC4 Response as text:",t),JSON.parse(t)}catch(e){throw console.error("❌ Second parse attempt failed:",e),Error("Could not parse response as JSON: ".concat(t))}}try{let t=await e.text();if(console.log("\uD83D\uDCC4 Response text (first 200 chars): ".concat(t.substring(0,200))),!e.ok){let o={status:e.status,statusText:e.statusText,message:t||"API request failed",responseData:t,url:e.url};throw console.error("❌ API Error (Text):",o),o}return t}catch(o){let t={status:e.status,statusText:e.statusText,message:"Failed to read response: ".concat(o),responseData:null,url:e.url};throw console.error("❌ API Error (Text Read Failed):",t),t}}function n(){{let e=localStorage.getItem("token");return e?(console.log("\uD83D\uDD0D Getting auth token: Found in localStorage (token)"),e):(e=localStorage.getItem("auth_token"))?(console.log("\uD83D\uDD0D Getting auth token: Found in localStorage (auth_token)"),localStorage.setItem("token",e),localStorage.removeItem("auth_token"),e):(console.log("\uD83D\uDD0D Getting auth token: Not found"),null)}}async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.startsWith("/")||(e="/"+e);let o=n(),r={"Content-Type":"application/json",...t.headers};o?(r.Authorization="Bearer ".concat(o),console.log("\uD83D\uDD11 Added Authorization header to request")):console.log("⚠️ No token found - sending request without authentication");let l="".concat(s).concat(e);console.log("\uD83D\uDE80 Making API call to: ".concat(l),{hasToken:!!o,environment:"production",method:t.method||"GET",headers:r});try{let o=await fetch(l,{...t,headers:r,credentials:"include"}),s=await a(o);return console.log("✅ API call completed for ".concat(e,":"),s),s}catch(t){throw console.error("\uD83D\uDCA5 API call failed for ".concat(e,":"),{url:l,error:t,errorMessage:t instanceof Error?t.message:"Unknown error",headers:r}),t&&"object"==typeof t&&(t.endpoint=e,t.fullUrl=l),t}}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(e,t)}async function c(){return r("/health")}console.log("\uD83D\uDD27 API Configuration:",{NEXT_PUBLIC_API_URL:"https://unity-voice-backend-production-46a1.up.railway.app/api",API_URL:s,NODE_ENV:"production"});let i={login:async e=>{console.log("\uD83D\uDD11 Starting login process...",{email:e.email});try{let t=await r("/auth/login",{method:"POST",body:JSON.stringify(e)});if(console.log("\uD83D\uDD0D Raw login result:",t),console.log("\uD83D\uDD0D Result type:",typeof t),console.log("\uD83D\uDD0D Has token?",!!(null==t?void 0:t.token)),console.log("\uD83D\uDD0D Has user?",!!(null==t?void 0:t.user)),console.log("\uD83D\uDD0D Token preview:",(null==t?void 0:t.token)?t.token.substring(0,20)+"...":"No token"),!t||!t.token)return console.log("❌ No token found in result"),{success:!1,message:"No token received from server",responseData:t};{console.log("\uD83D\uDCBE Saving token to localStorage..."),localStorage.setItem("token",t.token),console.log("\uD83C\uDF6A Saving token to cookie..."),function(e){if("undefined"!=typeof document){let t="https:"===window.location.protocol,o=["authToken=".concat(e),"path=/",...t?["SameSite=None","Secure"]:["SameSite=Lax"],"max-age=".concat(86400)];document.cookie=o.join("; "),console.log("\uD83C\uDF6A Token set in cookie:",{isProduction:t,cookieString:o.join("; ")})}}(t.token);let o=localStorage.getItem("token");console.log("✅ Token verification after save:",o?"SUCCESS":"FAILED");let s={success:!0,token:t.token,user:t.user||{email:e.email},message:"Login successful"};return console.log("\uD83C\uDF89 Login response:",s),s}}catch(e){return console.error("\uD83D\uDCA5 Login error:",e),{success:!1,message:e instanceof Error?e.message:"Login failed",error:e}}},register:async e=>r("/auth/register",{method:"POST",body:JSON.stringify(e)}),validate:async()=>{console.log("\uD83D\uDD0D Validating token...");let e=n();if(!e)return console.log("❌ No token found for validation"),{success:!1,message:"No token found"};try{let t=await r("/auth/validate",{method:"POST",body:JSON.stringify({token:e})});return console.log("✅ Token validation successful:",t),t}catch(e){return console.error("❌ Token validation failed:",e),{success:!1,message:"Token validation failed",error:e}}},logout:async()=>{if(console.log("\uD83D\uDC4B Starting logout process..."),localStorage.removeItem("token"),localStorage.removeItem("auth_token"),localStorage.removeItem("user"),console.log("\uD83D\uDDD1️ Cleared localStorage"),"undefined"!=typeof document){let e=["authToken=","path=/","expires=Thu, 01 Jan 1970 00:00:00 GMT",..."https:"===window.location.protocol?["SameSite=None","Secure"]:["SameSite=Lax"]];document.cookie=e.join("; "),console.log("\uD83C\uDF6A Cleared cookie")}try{return await r("/auth/logout",{method:"POST"})}catch(e){return console.log("⚠️ Logout API call failed, but local cleanup completed"),{success:!0,message:"Logged out locally"}}}},u={getProfile:async()=>r("/user/profile"),updateProfile:async e=>r("/user/profile",{method:"PUT",body:JSON.stringify(e)}),getData:async()=>r("/user/data")},g={getAll:async()=>r("/topics"),getById:async e=>r("/topics/".concat(e)),getUserProgress:async()=>r("/topics/progress")},d={create:async e=>r("/tasks",{method:"POST",body:JSON.stringify(e)}),getById:async e=>r("/tasks/".concat(e)),update:async(e,t)=>r("/tasks/".concat(e),{method:"PUT",body:JSON.stringify(t)}),getUserTasks:async e=>r("/tasks/user/".concat(e))},h={getByTopicAndLevel:async(e,t)=>{try{console.log('\uD83D\uDE80 Fetching flashcards: topic="'.concat(e,'", level="').concat(t,'"'));let o=await r("/flashcards/".concat(encodeURIComponent(e),"/").concat(t));if(o&&o.success)return console.log("✅ Received ".concat(o.data.length," flashcards")),o.data;if(Array.isArray(o))return console.log("✅ Received ".concat(o.length," flashcards (direct array)")),o;throw console.error("❌ Unexpected response format:",o),Error("Invalid response format from flashcards API")}catch(e){throw console.error("❌ Error fetching flashcards:",e),e}},create:async e=>r("/flashcards",{method:"POST",body:JSON.stringify(e)}),markAsLearned:async(e,t,o)=>r("/flashcards/mark-learned",{method:"POST",body:JSON.stringify({WordId:e,TaskId:t,TopicName:o})})}},66681:(e,t,o)=>{o.d(t,{A:()=>c});var s=o(12115),a=o(41008);let n=[],r={isAuthenticated:!1,isLoading:!0,user:null,error:null,isInitialized:!1},l=e=>{r=e,n.forEach(t=>t(e))},c=()=>{let[e,t]=(0,s.useState)(r);(0,s.useEffect)(()=>{let e=e=>t(e);return n.push(e),()=>{n=n.filter(t=>t!==e)}},[]);let o=(0,s.useCallback)(e=>{l(e)},[]),c=(0,s.useCallback)(async()=>{if(!localStorage.getItem("token"))return void o({isAuthenticated:!1,isLoading:!1,user:null,error:null,isInitialized:!0});try{let e=await a.zG.validate();if(e.success){let t=e.user||JSON.parse(localStorage.getItem("user")||"null");localStorage.setItem("user",JSON.stringify(t)),o({isAuthenticated:!0,isLoading:!1,user:t,error:null,isInitialized:!0})}else localStorage.removeItem("token"),localStorage.removeItem("user"),o({isAuthenticated:!1,isLoading:!1,user:null,error:e.message,isInitialized:!0})}catch(e){localStorage.removeItem("token"),localStorage.removeItem("user"),o({isAuthenticated:!1,isLoading:!1,user:null,error:"Validation error",isInitialized:!0})}},[o]);(0,s.useEffect)(()=>{c()},[c]);let i=async(e,t)=>{o({...r,isLoading:!0});try{let s=await a.zG.login({email:e,password:t});if(s.success||s.token){localStorage.setItem("token",s.token);let t=s.user||{email:e};return localStorage.setItem("user",JSON.stringify(t)),o({isAuthenticated:!0,isLoading:!1,user:t,error:null,isInitialized:!0}),{success:!0,token:s.token}}return o({isAuthenticated:!1,isLoading:!1,user:null,error:s.message||"Login failed",isInitialized:!0}),{success:!1,message:s.message}}catch(e){return o({isAuthenticated:!1,isLoading:!1,user:null,error:e.message,isInitialized:!0}),{success:!1,message:e.message}}},u=async()=>{try{await a.zG.logout()}catch(e){}localStorage.removeItem("token"),localStorage.removeItem("user"),o({isAuthenticated:!1,isLoading:!1,user:null,error:null,isInitialized:!0})};return{...e,login:i,logout:u,validateAuth:c}}}}]);