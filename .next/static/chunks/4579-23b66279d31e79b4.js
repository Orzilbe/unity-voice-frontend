"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4579],{41008:(e,t,r)=>{r.d(t,{Av:()=>n,Ly:()=>g,bZ:()=>l,e$:()=>d,kV:()=>c,l6:()=>u,zG:()=>i});let s=r(49509).env.NEXT_PUBLIC_API_URL;async function o(e){let t=e.headers.get("content-type");if(console.log("Response status: ".concat(e.status,", Content-Type: ").concat(t)),t&&t.includes("application/json"))try{let t=await e.json();if(!e.ok){let r={status:e.status,statusText:e.statusText,message:t.message||t.error||"API request failed",responseData:t,url:e.url};throw console.error("API Error (JSON):",r),r}return t}catch(t){if(!e.ok){let r={status:e.status,statusText:e.statusText,message:"Failed to parse JSON response: ".concat(t),responseData:null,url:e.url};throw console.error("API Error (JSON Parse Failed):",r),r}throw t}try{let t=await e.text();if(console.log("Response text (first 200 chars): ".concat(t.substring(0,200))),!e.ok){let r={status:e.status,statusText:e.statusText,message:t||"API request failed",responseData:t,url:e.url};throw console.error("API Error (Text):",r),r}return t}catch(r){let t={status:e.status,statusText:e.statusText,message:"Failed to read response: ".concat(r),responseData:null,url:e.url};throw console.error("API Error (Text Read Failed):",t),t}}async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={"Content-Type":"application/json",...t.headers},a="".concat(s).concat(e);console.log("Making API call to: ".concat(a));try{let e=await fetch(a,{...t,headers:r,credentials:"include"});return await o(e)}catch(t){throw console.error("API call failed for ".concat(e,":"),{url:a,error:t,errorMessage:t instanceof Error?t.message:"Unknown error",errorStack:t instanceof Error?t.stack:void 0,headers:r}),t&&"object"==typeof t&&(t.endpoint=e,t.fullUrl=a),t}}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a(e,t)}async function l(){return a("/health")}let i={login:async e=>a("/auth/login",{method:"POST",body:JSON.stringify(e)}),register:async e=>a("/auth/register",{method:"POST",body:JSON.stringify(e)}),validate:async()=>a("/auth/validate",{method:"POST",body:JSON.stringify({})}),logout:async()=>a("/auth/logout",{method:"POST"})},c={getProfile:async()=>a("/user/profile"),updateProfile:async e=>a("/user/profile",{method:"PUT",body:JSON.stringify(e)}),getData:async()=>a("/user/data")},u={getAll:async()=>a("/topics"),getById:async e=>a("/topics/".concat(e)),getUserProgress:async()=>a("/topics/progress")},d={create:async e=>a("/tasks",{method:"POST",body:JSON.stringify(e)}),getById:async e=>a("/tasks/".concat(e)),update:async(e,t)=>a("/tasks/".concat(e),{method:"PUT",body:JSON.stringify(t)}),getUserTasks:async e=>a("/tasks/user/".concat(e))},g={getByTopicAndLevel:async(e,t)=>{try{console.log('\uD83D\uDE80 Fetching flashcards: topic="'.concat(e,'", level="').concat(t,'"'));let r=await a("/flashcards/".concat(encodeURIComponent(e),"/").concat(t));if(r&&r.success)return console.log("✅ Received ".concat(r.data.length," unlearned flashcards")),r.data;if(Array.isArray(r))return console.log("✅ Received ".concat(r.length," unlearned flashcards (direct array)")),r;throw console.error("❌ Unexpected response format:",r),Error("Invalid response format from flashcards API")}catch(e){throw console.error("❌ Error fetching flashcards:",e),e}},create:async e=>a("/flashcards",{method:"POST",body:JSON.stringify(e)}),markAsLearned:async(e,t,r)=>a("/flashcards/mark-learned",{method:"POST",body:JSON.stringify({WordId:e,TaskId:t,TopicName:r})})}},66681:(e,t,r)=>{r.d(t,{A:()=>i});var s=r(12115),o=r(41008);let a=[],n={isAuthenticated:!1,isLoading:!0,user:null,error:null,isInitialized:!1},l=e=>{n=e,a.forEach(t=>t(e))},i=()=>{let[e,t]=(0,s.useState)(n);(0,s.useEffect)(()=>{let e=e=>{t(e)};return a.push(e),()=>{a=a.filter(t=>t!==e)}},[]);let r=(0,s.useCallback)(e=>{t(e),l(e)},[]),i=(0,s.useCallback)(async()=>{console.log("\uD83D\uDD0D Starting auth validation...");try{let e=await o.zG.validate();if(console.log("\uD83D\uDCE1 Validation response:",e),!e.valid&&!e.success)return localStorage.removeItem("user"),r({isAuthenticated:!1,isLoading:!1,user:null,error:e.message||"Authentication failed",isInitialized:!0}),!1;{let t=e.user;if(!t||!t.role&&!t.UserRole){let e=localStorage.getItem("user");if(e)try{t={...JSON.parse(e),...t}}catch(e){console.error("Error parsing stored user data:",e)}}return t&&(t={...t,role:t.role||t.UserRole||"user",UserRole:t.UserRole||t.role||"user"}),r({isAuthenticated:!0,isLoading:!1,user:t,error:null,isInitialized:!0}),!0}}catch(t){console.error("Auth validation error:",t);let e=localStorage.getItem("user");if(e)try{let t=JSON.parse(e);return r({isAuthenticated:!0,isLoading:!1,user:t,error:null,isInitialized:!0}),!0}catch(e){console.error("Error parsing stored user data:",e)}return localStorage.removeItem("user"),r({isAuthenticated:!1,isLoading:!1,user:null,error:t instanceof Error?t.message:"Authentication error",isInitialized:!0}),!1}},[r]);(0,s.useEffect)(()=>{i()},[i]);let c=async function(t,s){arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{console.log("\uD83D\uDD10 Starting login process..."),r({...e,isLoading:!0});let a=await o.zG.login({email:t,password:s});if(console.log("\uD83D\uDCE1 Login response:",a),!a.success)return r({isAuthenticated:!1,isLoading:!1,user:null,error:a.message||"Login failed",isInitialized:!0}),{success:!1,message:a.message||"Login failed"};{let e=a.user||{email:t},s={...e,role:(null==e?void 0:e.role)||(null==e?void 0:e.UserRole)||"user",UserRole:(null==e?void 0:e.UserRole)||(null==e?void 0:e.role)||"user"};return localStorage.setItem("user",JSON.stringify(s)),r({isAuthenticated:!0,isLoading:!1,user:s,error:null,isInitialized:!0}),{success:!0}}}catch(t){if(console.error("❌ Login error:",t),t.responseData){let e=t.responseData.message||t.message||"Login failed";return console.log("API Error details:",t.responseData),r({isAuthenticated:!1,isLoading:!1,user:null,error:e,isInitialized:!0}),{success:!1,message:e,details:t.responseData.details}}let e=t instanceof Error?t.message:"An unexpected error occurred";return r({isAuthenticated:!1,isLoading:!1,user:null,error:e,isInitialized:!0}),{success:!1,message:e}}},u=async()=>{console.log("\uD83D\uDC4B Logging out...");try{await o.zG.logout()}catch(e){console.error("Logout API call failed:",e)}localStorage.removeItem("user"),r({isAuthenticated:!1,isLoading:!1,user:null,error:null,isInitialized:!0})};return{...e,login:c,logout:u,validateAuth:i}}},79323:(e,t,r)=>{function s(){{let e=localStorage.getItem("token");if(e)return e;for(let e of document.cookie.split(";")){let[t,r]=e.trim().split("=");if("token"===t)return r}}return null}r.d(t,{c4:()=>s}),r(58801),r(41008),r(49509)}}]);