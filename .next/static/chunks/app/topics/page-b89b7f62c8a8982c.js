(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6443],{21944:(e,o,s)=>{"use strict";s.r(o),s.d(o,{default:()=>m});var t=s(95155),a=s(11518),l=s.n(a),r=s(12115),n=s(35695),i=s(66766),c=s(41008);let d=e=>{let{isVisible:o=!1,onToggle:s,showIcon:a=!0}=e,[l,n]=(0,r.useState)(null),[d,f]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let e=async()=>{if(o){console.log("\uD83D\uDCCA UserProfile: Fetching user data..."),f(!0);try{let e=await (0,c.Av)("/user/data");n({FirstName:e.FirstName||"",LastName:e.LastName||"",Email:e.Email||"",PhoneNumber:e.PhoneNumber||"",EnglishLevel:e.EnglishLevel||"Not Set",AgeRange:e.AgeRange||"",ProfilePicture:e.ProfilePicture||null,CreationDate:new Date(e.CreationDate),LastLogin:e.LastLogin?new Date(e.LastLogin):void 0,Score:e.Score||0}),f(!1),console.log("✅ UserProfile: User data loaded successfully")}catch(e){console.error("❌ UserProfile: Error fetching user data:",e),f(!1)}}};o&&e()},[o]);let x=()=>{console.log("\uD83D\uDD04 UserProfile: Toggle clicked"),s&&s()};return(0,t.jsxs)(t.Fragment,{children:[a&&(0,t.jsx)("div",{className:"absolute top-4 right-4",children:(0,t.jsx)("div",{className:"w-12 h-12 rounded-full bg-white shadow-lg flex items-center justify-center cursor-pointer hover:shadow-xl transform hover:scale-105 transition-all duration-300",onClick:x,children:(null==l?void 0:l.ProfilePicture)?(0,t.jsx)(i.default,{src:l.ProfilePicture,alt:"Profile",width:48,height:48,className:"w-full h-full rounded-full object-cover"}):(0,t.jsx)("span",{className:"text-2xl",children:"\uD83D\uDC64"})})}),o&&(0,t.jsxs)("div",{className:"absolute top-20 right-4 bg-white p-6 shadow-2xl rounded-2xl w-80 z-50 border border-gray-100 transform transition-all duration-300",children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-gray-800",children:"User Profile"}),d?(0,t.jsx)("div",{className:"flex justify-center items-center h-40",children:(0,t.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"})}):l?(0,t.jsxs)("div",{className:"space-y-3 text-gray-800",children:[l.ProfilePicture&&(0,t.jsx)("div",{className:"flex justify-center mb-4",children:(0,t.jsx)(i.default,{src:l.ProfilePicture,alt:"Profile",width:96,height:96,className:"w-24 h-24 rounded-full object-cover border-4 border-gray-200"})}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("p",{className:"flex justify-between",children:[(0,t.jsx)("strong",{children:"Name:"}),(0,t.jsx)("span",{children:(null==l?void 0:l.FirstName)||(null==l?void 0:l.LastName)?"".concat((null==l?void 0:l.FirstName)||""," ").concat((null==l?void 0:l.LastName)||"").trim():"Guest User"})]}),(0,t.jsxs)("p",{className:"flex justify-between",children:[(0,t.jsx)("strong",{children:"Email:"}),(0,t.jsx)("span",{className:"text-right",children:l.Email||"Not provided"})]}),(0,t.jsxs)("p",{className:"flex justify-between",children:[(0,t.jsx)("strong",{children:"Phone:"}),(0,t.jsx)("span",{children:l.PhoneNumber||"Not provided"})]}),(0,t.jsxs)("p",{className:"flex justify-between",children:[(0,t.jsx)("strong",{children:"English Level:"}),(0,t.jsx)("span",{children:l.EnglishLevel})]}),l.AgeRange&&(0,t.jsxs)("p",{className:"flex justify-between",children:[(0,t.jsx)("strong",{children:"Age Range:"}),(0,t.jsx)("span",{children:l.AgeRange})]}),(0,t.jsxs)("p",{className:"flex justify-between",children:[(0,t.jsx)("strong",{children:"Score:"}),(0,t.jsx)("span",{children:l.Score})]}),(0,t.jsxs)("p",{className:"flex justify-between",children:[(0,t.jsx)("strong",{children:"Member Since:"}),(0,t.jsx)("span",{children:l.CreationDate.toLocaleDateString()})]})]})]}):(0,t.jsx)("p",{className:"text-red-500",children:"Failed to load user data"}),(0,t.jsx)("div",{className:"mt-6 space-y-2",children:(0,t.jsx)("button",{className:"w-full py-2 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-colors",onClick:x,children:"Close"})})]})]})},f=e=>{let{topic:o,userId:s,onError:a}=e,l=(0,n.useRouter)(),[i,d]=(0,r.useState)(!1),f=async e=>{if(e.preventDefault(),!i){d(!0);try{if(!s||""===s||"0"===s)throw Error("לא נמצא מזהה משתמש תקין - יש להתחבר מחדש");if(!localStorage.getItem("token"))throw Error("לא נמצא טוקן אימות - יש להתחבר מחדש");let e=o.TopicName.toLowerCase().replace(/\s+/g,"-");console.log("Creating task for topic: ".concat(o.TopicName,", userId: ").concat(s));try{let t=await c.e$.create({UserId:s,TopicName:o.TopicName,Level:1,TaskType:"flashcard"});if(!t||!t.TaskId)throw Error("לא התקבל מזהה משימה מהשרת");let a=t.TaskId;console.log("Task created successfully with ID:",a);let r="/topics/".concat(e,"/tasks/flashcard?level=1&taskId=").concat(a);console.log("Navigating to: ".concat(r)),l.push(r)}catch(e){var t;if(console.error("API Error details:",e),401===e.status)throw Error("פג תוקף ההתחברות - יש להתחבר מחדש");if(403===e.status)throw Error("אין הרשאה לבצע פעולה זו");if(400===e.status)throw Error(e.message||"נתונים לא תקינים");else if(null==(t=e.responseData)?void 0:t.message)throw Error(e.responseData.message);else throw Error("אירעה שגיאה בתקשורת עם השרת")}}catch(e){if(console.error("Error in topic selection:",e),e instanceof Error&&(e.message.includes("401")||e.message.includes("אימות")||e.message.includes("להתחבר")||e.message.includes("פג תוקף"))){console.log("Authentication error detected - redirecting to login"),l.push("/login");return}a&&a(e instanceof Error?e.message:"אירעה שגיאה בהתחלת פעילות. אנא נסה שוב.")}finally{d(!1)}}};return(0,t.jsx)("div",{onClick:f,className:"group bg-white p-6 rounded-2xl shadow-md hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 cursor-pointer ".concat(i?"opacity-75":""),children:(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[i?(0,t.jsx)("div",{className:"w-10 h-10 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"}):(0,t.jsx)("span",{className:"text-4xl group-hover:scale-110 transition-transform duration-300",children:o.Icon||"\uD83C\uDF1F"}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-2 group-hover:text-orange-600 transition-colors",children:o.TopicName}),(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:o.TopicHe})]})]})})};var x=s(66681);function g(){localStorage.removeItem("token"),localStorage.removeItem("user"),document.cookie="authToken=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Strict; Secure"}var u=s(6874),h=s.n(u);function m(){let[e,o]=(0,r.useState)([]),[s,a]=(0,r.useState)({level:"",points:0,totalScore:0,completedTasks:0,activeSince:"",nextLevel:"",pointsToNextLevel:100}),[i,u]=(0,r.useState)(!1),[m,p]=(0,r.useState)(null),{isAuthenticated:j,isLoading:N,user:v,isInitialized:b,logout:y}=(0,x.A)(),w=(0,n.useRouter)();console.log("\uD83D\uDD0D Topics page - Auth State:",{isAuthenticated:j,isLoading:N,isInitialized:b,user:v}),(0,r.useEffect)(()=>{(async()=>{if(console.log("\uD83D\uDD04 Topics page - Checking auth:",{isInitialized:b,isLoading:N,isAuthenticated:j}),!b||N||j)b&&!N&&j&&console.log("✅ User authenticated, staying on topics page");else{console.log("❌ User not authenticated, redirecting to login...");try{await w.push("/login"),console.log("✅ Navigation to login initiated")}catch(e){console.error("❌ Navigation failed:",e),window.location.href="/login"}}})()},[j,N,b,w]),(0,r.useEffect)(()=>{if(j){let e=async()=>{try{console.log("\uD83D\uDD0D === DEBUG: Starting fetchUserData ==="),console.log("\uD83D\uDD0D Current user from useAuth:",v),console.log("\uD83D\uDD0D Token in localStorage:",localStorage.getItem("token")),console.log("\uD83D\uDD0D IsAuthenticated:",j);let e=await c.kV.getData();console.log("\uD83D\uDD0D === RAW API Response ==="),console.log("\uD83D\uDD0D Full response:",e),console.log("\uD83D\uDD0D Response type:",typeof e),console.log("\uD83D\uDD0D Response keys:",Object.keys(e||{})),console.log("\uD83D\uDD0D Score field:",null==e?void 0:e.Score),console.log("\uD83D\uDD0D CurrentLevel field:",null==e?void 0:e.currentLevel),console.log("\uD83D\uDD0D CreationDate field:",null==e?void 0:e.CreationDate),console.log("\uD83D\uDD0D === END RAW RESPONSE ===");let o={level:e.currentLevel||"Beginner",points:e.currentLevelPoints||0,totalScore:e.Score||0,completedTasks:e.completedTasksCount||0,activeSince:e.CreationDate?new Date(e.CreationDate).toLocaleDateString():"Today",nextLevel:e.nextLevel||"Intermediate",pointsToNextLevel:e.pointsToNextLevel||100};console.log("\uD83D\uDD0D === MAPPED USER DATA ==="),console.log("\uD83D\uDD0D Mapped data:",o),console.log("\uD83D\uDD0D Final totalScore:",o.totalScore),console.log("\uD83D\uDD0D === END MAPPED DATA ==="),a(o),console.log("✅ User data set successfully")}catch(o){console.error("❌ === API FAILED ==="),console.error("❌ Error details:",o),console.error("❌ Error type:",typeof o),console.error("❌ Error message:",o instanceof Error?o.message:"Unknown error"),console.error("❌ === USING FALLBACK DATA ===");let e={level:"Beginner",points:150,totalScore:850,completedTasks:12,activeSince:new Date().toLocaleDateString(),nextLevel:"Intermediate",pointsToNextLevel:250};console.log("\uD83D\uDD04 Setting fallback data:",e),a(e)}};(async()=>{try{console.log("\uD83D\uDD04 Starting to fetch topics...");let e=await c.l6.getAll();console.log("✅ Topics data received:",e),console.log("\uD83D\uDD0D Topics count:",Array.isArray(e)?e.length:"Not array"),console.log("\uD83D\uDD0D First topic:",null==e?void 0:e[0]),o(e),console.log("✅ Topics state updated")}catch(e){console.error("❌ Error fetching topics:",e),console.error("❌ Error type:",typeof e),console.error("❌ Error details:",e instanceof Error?e.message:"Unknown error"),console.log("\uD83D\uDD04 Using mock topics data as fallback"),o([{TopicName:"Diplomacy and International Relations",TopicHe:"דיפלומטיה ויחסים בינלאומיים",Icon:"\uD83E\uDD1D"},{TopicName:"Economy and Entrepreneurship",TopicHe:"כלכלה ויזמות",Icon:"\uD83D\uDCB0"},{TopicName:"Environment and Sustainability",TopicHe:"סביבה וקיימות",Icon:"\uD83C\uDF31"},{TopicName:"History and Heritage",TopicHe:"הסטוריה ומורשת",Icon:"\uD83C\uDFDB️"},{TopicName:"Holocaust and Revival",TopicHe:"שואה ותקומה",Icon:"✡️"},{TopicName:"Innovation and Technology",TopicHe:"חדשנות וטכנולוגיה",Icon:"\uD83D\uDCA1"},{TopicName:"Iron Swords War",TopicHe:"מלחמת חרבות ברזל",Icon:"⚔️"},{TopicName:"Society and Multiculturalism",TopicHe:"חברה ורב תרבותיות",Icon:"\uD83C\uDF0D"}])}})(),e()}},[j]);let T=e=>{p(e),setTimeout(()=>p(null),5e3)};return!b||N?(0,t.jsx)("div",{className:"flex justify-center items-center min-h-screen bg-gradient-to-br from-blue-50 to-teal-50 font-sans",children:(0,t.jsxs)("div",{className:"flex flex-col items-center bg-white p-8 rounded-lg shadow-lg",children:[(0,t.jsx)("div",{className:"text-2xl text-teal-600 mb-4",children:b?"Loading Topics...":"Initializing..."}),(0,t.jsx)("div",{className:"w-16 h-16 border-t-4 border-b-4 border-teal-500 rounded-full animate-spin mb-4"}),(0,t.jsx)("div",{className:"text-sm text-gray-600 text-center",children:b?(0,t.jsx)("p",{children:"Fetching your personalized topics..."}):(0,t.jsx)("p",{children:"Setting up your session..."})}),(0,t.jsxs)("div",{className:"mt-4 text-xs text-gray-500",children:["Status: ",b?"Loading Data":"Initializing Auth"]})]})}):j?(console.log("✅ Topics page: Rendering content for authenticated user"),console.log("\uD83D\uDD0D Current topics in render:",e),console.log("\uD83D\uDD0D Topics length:",e.length),(0,t.jsxs)("div",{className:"jsx-26af8af8a308f6d6 min-h-screen bg-gradient-to-br from-yellow-50 via-orange-50 to-red-50 p-6 relative",children:[(0,t.jsx)(l(),{id:"26af8af8a308f6d6",children:'@import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap");body{font-family:"Poppins",sans-serif}'}),(0,t.jsx)(d,{isVisible:i,onToggle:()=>u(!i),showIcon:!0}),(0,t.jsxs)("div",{className:"jsx-26af8af8a308f6d6 max-w-7xl mx-auto",children:[(0,t.jsx)("h1",{className:"jsx-26af8af8a308f6d6 text-5xl font-bold mb-8 text-center bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent",children:"Choose Your Topic"}),(0,t.jsxs)("div",{className:"jsx-26af8af8a308f6d6 grid grid-cols-3 gap-4 mb-10",children:[(0,t.jsxs)("div",{className:"jsx-26af8af8a308f6d6 bg-white rounded-xl shadow-md p-4 flex flex-col items-center",children:[(0,t.jsx)("div",{className:"jsx-26af8af8a308f6d6 w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center mb-2",children:(0,t.jsx)("span",{className:"jsx-26af8af8a308f6d6 text-xl",children:"\uD83C\uDFAF"})}),(0,t.jsx)("p",{className:"jsx-26af8af8a308f6d6 text-sm text-gray-500",children:"Total Score"}),(0,t.jsx)("p",{className:"jsx-26af8af8a308f6d6 text-2xl font-bold text-orange-600",children:s.totalScore}),(0,t.jsx)("p",{className:"jsx-26af8af8a308f6d6 text-xs text-gray-400",children:"points"})]}),(0,t.jsxs)("div",{className:"jsx-26af8af8a308f6d6 bg-white rounded-xl shadow-md p-4 flex flex-col items-center",children:[(0,t.jsx)("div",{className:"jsx-26af8af8a308f6d6 w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center mb-2",children:(0,t.jsx)("span",{className:"jsx-26af8af8a308f6d6 text-xl",children:"✅"})}),(0,t.jsx)("p",{className:"jsx-26af8af8a308f6d6 text-sm text-gray-500",children:"Completed Tasks"}),(0,t.jsx)("p",{className:"jsx-26af8af8a308f6d6 text-2xl font-bold text-orange-600",children:s.completedTasks}),(0,t.jsx)("p",{className:"jsx-26af8af8a308f6d6 text-xs text-gray-400",children:"activities"})]}),(0,t.jsxs)("div",{className:"jsx-26af8af8a308f6d6 bg-white rounded-xl shadow-md p-4 flex flex-col items-center",children:[(0,t.jsx)("div",{className:"jsx-26af8af8a308f6d6 w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center mb-2",children:(0,t.jsx)("span",{className:"jsx-26af8af8a308f6d6 text-xl",children:"⏱️"})}),(0,t.jsx)("p",{className:"jsx-26af8af8a308f6d6 text-sm text-gray-500",children:"Active Since"}),(0,t.jsx)("p",{className:"jsx-26af8af8a308f6d6 text-2xl font-bold text-orange-600",children:s.activeSince})]})]}),v&&"admin"===v.role&&(0,t.jsx)("div",{className:"jsx-26af8af8a308f6d6 flex justify-center mb-4",children:(0,t.jsxs)(h(),{href:"/dashboard",onClick:e=>{if(console.log("Dashboard link clicked"),!localStorage.getItem("token")){e.preventDefault(),console.error("No token found in localStorage");return}},className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-700 text-white font-semibold rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 flex items-center cursor-pointer",children:[(0,t.jsx)("span",{className:"jsx-26af8af8a308f6d6 mr-2 text-xl",children:"\uD83D\uDCCA"}),(0,t.jsx)("span",{className:"jsx-26af8af8a308f6d6",children:"Dashboard"})]})}),m&&(0,t.jsx)("div",{className:"jsx-26af8af8a308f6d6 bg-red-100 text-red-700 p-4 rounded-lg mb-6 text-center",children:m}),(0,t.jsx)("div",{className:"jsx-26af8af8a308f6d6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:e.map(e=>(0,t.jsx)(f,{topic:e,userId:(null==v?void 0:v.UserId)||(null==v?void 0:v.userId)||(null==v?void 0:v.id)||"",onError:T},e.TopicName))})]}),(0,t.jsx)("div",{className:"jsx-26af8af8a308f6d6 absolute top-4 left-4 flex space-x-3",children:(0,t.jsx)("button",{onClick:async()=>{console.log("\uD83D\uDC4B Logout button clicked - starting cleanup...");try{await y(),console.log("✅ useAuth logout completed"),g(),console.log("✅ clearAuthData completed"),localStorage.clear(),console.log("✅ localStorage cleared"),document.cookie.split(";").forEach(e=>{let o=e.indexOf("="),s=o>-1?e.substr(0,o):e;document.cookie="".concat(s.trim(),"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/")}),console.log("✅ All cookies cleared"),console.log("\uD83D\uDD04 Redirecting to login..."),w.push("/login")}catch(e){console.error("❌ Error during logout:",e),g(),localStorage.clear(),window.location.href="/login"}},className:"jsx-26af8af8a308f6d6 w-12 h-12 rounded-full bg-white shadow-lg flex items-center justify-center hover:shadow-xl transform hover:scale-105 transition-all duration-300",children:(0,t.jsx)("span",{className:"jsx-26af8af8a308f6d6 text-2xl",children:"\uD83D\uDC4B"})})})]})):(console.log("\uD83D\uDEAB Topics page: User not authenticated, returning null..."),null)}},84262:(e,o,s)=>{Promise.resolve().then(s.bind(s,21944))}},e=>{var o=o=>e(e.s=o);e.O(0,[6874,9443,6681,8441,1684,7358],()=>o(84262)),_N_E=e.O()}]);