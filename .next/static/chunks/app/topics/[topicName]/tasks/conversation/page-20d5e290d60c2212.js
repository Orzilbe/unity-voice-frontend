(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3255],{10011:(e,t,r)=>{"use strict";let n;r.r(t),r.d(t,{default:()=>f});var s=r(95155),o=r(11518),a=r.n(o);let i={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},c=new Uint8Array(16),l=[];for(let e=0;e<256;++e)l.push((e+256).toString(16).slice(1));let d=function(e,t,r){if(i.randomUUID&&!t&&!e)return i.randomUUID();let s=(e=e||{}).random??e.rng?.()??function(){if(!n){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");n=crypto.getRandomValues.bind(crypto)}return n(c)}();if(s.length<16)throw Error("Random bytes length must be >= 16");if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=s[e];return t}return function(e,t=0){return(l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]).toLowerCase()}(s)};var u=r(12115),g=r(6874),h=r.n(g),p=r(35695),m=r(79323),x=r(66681);function f(){let e=(0,p.useRouter)(),t=(0,p.useParams)(),r=(0,p.useSearchParams)(),n=null==t?void 0:t.topicName,o=(null==r?void 0:r.get("level"))||"1",i=null==r?void 0:r.get("taskId"),{isAuthenticated:c,isLoading:l,user:g}=(0,x.A)(),[f,y]=(0,u.useState)(!1),[j,b]=(0,u.useState)([]),[w,v]=(0,u.useState)(!0),[k,N]=(0,u.useState)([]),[S,T]=(0,u.useState)({messagesExchanged:0,correctWords:0,averageScore:0,totalScore:0}),[I,E]=(0,u.useState)(null),[A,C]=(0,u.useState)(!1),[P,R]=(0,u.useState)(!1),[D,O]=(0,u.useState)(!1),[U,L]=(0,u.useState)(!1),[q,W]=(0,u.useState)([]),[M,z]=(0,u.useState)(null),[F,_]=(0,u.useState)(null),[J,Q]=(0,u.useState)(0),B=(0,u.useRef)(null),Y=(0,u.useRef)(null),V=(0,u.useRef)(null),G=(0,u.useRef)(null),$=(0,u.useRef)(null),H=(0,u.useRef)(null),K=(0,u.useRef)(null),X=(0,u.useRef)(null),[Z,ee]=(0,u.useState)([]),[et,er]=(0,u.useState)("");(0,u.useEffect)(()=>{(async()=>{if(c)if(!i&&n&&o)try{let t=(0,m.c4)();if(!t)throw Error("Authentication required");console.log("Creating new conversation task"),console.log("Topic Name:",n),console.log("Formatted Topic Name:",en(n)),console.log("Level:",o);let r=await fetch("/api/tasks",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({TopicName:en(n),Level:parseInt(o),TaskType:"conversation"})});if(console.log("API Response status:",r.status),!r.ok){let e=await r.text();console.error("API Error Response:",e);let t="Failed to create conversation task";try{let r=JSON.parse(e);t=r.message||r.error||t}catch(e){}throw Error(t)}let s=await r.json();if(console.log("Created conversation task:",s),s.TaskId){let t="/topics/".concat(n,"/tasks/conversation?level=").concat(o,"&taskId=").concat(s.TaskId);console.log("Redirecting to:",t),sessionStorage.setItem("task_start_".concat(s.TaskId),Date.now().toString()),e.push(t)}else throw Error("No TaskId returned from server")}catch(e){console.error("Error creating conversation task:",e),E("Failed to initialize conversation task: ".concat(e instanceof Error?e.message:"Unknown error"))}else i&&sessionStorage.setItem("task_start_".concat(i),Date.now().toString())})()},[c,i,n,o,e]),(0,u.useEffect)(()=>{!l&&c&&!i&&n&&o&&console.log("No taskId found in URL, need to create or redirect")},[l,c,i,n,o]),(0,u.useEffect)(()=>{try{let e=window.SpeechRecognition||window.webkitSpeechRecognition;e&&(B.current=new e,B.current.continuous=!1,B.current.interimResults=!0,B.current.lang="en-US",B.current.onresult=e=>{let t=e.results[e.results.length-1];if(t.isFinal){let e=t[0].transcript.trim();if(e.length>1){var r;let t=(null==(r=j.find(e=>"ai"===e.type))?void 0:r.content)||"";if(function(e,t){let r=e.toLowerCase().replace(/[^\w\s]/g,""),n=t.toLowerCase().replace(/[^\w\s]/g,""),s=r.split(/\s+/).filter(e=>e.length>2),o=n.split(/\s+/).filter(e=>e.length>2);if(0===s.length||0===o.length)return 0;let a=0,i=Math.min(6,Math.min(s.length,o.length)),c=0;for(let e=0;e<i;e++)e<s.length&&e<o.length&&s[e]===o[e]&&c++;if(c>=3||i>0&&c/i>=.5)return .9;for(let e of s)o.includes(e)&&e.length>3&&a++;return a/Math.max(s.length,1)}(e,t)>.7)return void console.log("Detected echo of AI's own speech, ignoring");console.log("Final transcript:",e),ea(e)}}},B.current.onstart=()=>{console.log("Recognition started"),O(!1)},B.current.onspeechstart=()=>{console.log("Speech detected"),O(!0),$.current&&(clearTimeout($.current),$.current=null)},B.current.onspeechend=()=>{console.log("Speech ended"),$.current=window.setTimeout(()=>{O(!1);try{B.current.stop()}catch(e){console.log("Error stopping recognition",e)}},1e3)},B.current.onend=()=>{if(console.log("Recognition ended"),U&&!D){console.log("Restarting recognition");try{B.current.start()}catch(e){console.log("Error restarting recognition",e),setTimeout(()=>{if(U)try{B.current.start()}catch(e){console.log("Failed to restart recognition again",e)}},500)}}},B.current.onerror=e=>{if(console.error("Recognition error:",e.error),"no-speech"===e.error&&U)try{B.current.stop(),setTimeout(()=>{if(U)try{B.current.start(),b(e=>e.some(e=>"ai"===e.type&&e.content.includes("waiting for your response"))?e:[...e,{type:"ai",content:"I'm waiting for your response. Please speak clearly when the microphone is active.",feedback:"Microphone is listening"}])}catch(e){console.log("Error restarting after no-speech",e)}},300)}catch(e){console.log("Error handling no-speech",e)}}),Y.current=window.speechSynthesis}catch(e){console.error("Error initializing speech APIs:",e),E("Speech recognition not available in your browser")}return()=>{if(B.current)try{B.current.stop()}catch(e){console.log("Error stopping recognition on cleanup",e)}Y.current&&Y.current.cancel(),[G.current,$.current,X.current].forEach(e=>{e&&clearTimeout(e)})}},[]),(0,u.useEffect)(()=>{(async()=>{if(c&&n)try{v(!0),E(null);let e=(0,m.c4)();if(!e)throw Error("Authentication required");try{let t=await fetch("/api/words/required?topic=".concat(encodeURIComponent(en(n)),"&level=").concat(o),{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();console.log("Required words response:",e),e.success&&Array.isArray(e.data)?(N(e.data),console.log("Loaded ".concat(e.data.length," required words"))):Array.isArray(e)?N(e):(console.warn("No required words found for this topic and level"),N([]))}else console.error("Failed to fetch required words:",t.status),N([])}catch(e){console.error("Error loading required words:",e),N([])}}catch(e){console.error("Error loading initial data:",e),E(e instanceof Error?e.message:"Failed to load data")}finally{v(!1)}})()},[c,n,o]),(0,u.useEffect)(()=>{var e;null==(e=V.current)||e.scrollIntoView({behavior:"smooth"})},[j]),(0,u.useEffect)(()=>{if(q.length>0&&!P&&f){let e=q[0];W(e=>e.slice(1)),ei(e,()=>{q.length<=1&&f&&setTimeout(()=>{L(!0),eo()},500)})}},[q,P,f]);let en=e=>e.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),es=e=>en(e),eo=()=>{if(B.current)try{console.log("Activating microphone"),B.current.start(),b(e=>{let t=e[e.length-1];return t&&"ai"===t.type&&t.content.includes("Microphone is active")?e:[...e,{type:"ai",content:"\uD83C\uDFA4 Microphone is active. Please speak now.",feedback:"Your turn to speak"}]}),G.current&&clearTimeout(G.current),G.current=window.setTimeout(()=>{if(U&&!D){try{var e;null==(e=B.current)||e.stop(),L(!1)}catch(e){console.log("Error stopping recognition on timeout",e)}let t="I didn't hear your response. Let's move on to the next question.";b(e=>[...e,{type:"ai",content:t}]),W(e=>[...e,t,"Let's try again. "+eu()])}},2e4)}catch(e){console.error("Could not start speech recognition:",e),b(e=>[...e,{type:"ai",content:"I'm having trouble with the microphone. Please try refreshing the page.",feedback:"Microphone error"}])}},ea=async e=>{L(!1),O(!1),X.current&&clearTimeout(X.current),X.current=window.setTimeout(()=>{if(U&&f){let e="Are you still there? I'm waiting for your response.";b(t=>[...t,{type:"ai",content:e}]),W(t=>[...t,e])}},3e4);try{B.current&&B.current.stop()}catch(e){console.log("Error stopping recognition after response",e)}b(t=>[...t,{type:"user",content:e}]);try{var t,r,n,s,o,a;b(e=>[...e,{type:"ai",content:"...",feedback:"Analyzing your response..."}]);let i=await ec(e);if((null==(t=i.pronunciationTips)?void 0:t.length)||(null==(r=i.grammarTips)?void 0:r.length)||(null==(n=i.suggestions)?void 0:n.length)){let e="";(null==(s=i.pronunciationTips)?void 0:s.length)&&(e+="\uD83D\uDCA1 Pronunciation: ".concat(i.pronunciationTips[0],"\n")),(null==(o=i.grammarTips)?void 0:o.length)&&(e+="✍️ Grammar: ".concat(i.grammarTips[0],"\n")),(null==(a=i.suggestions)?void 0:a.length)&&(e+="\uD83D\uDCAD Suggestion: ".concat(i.suggestions[0])),e&&(b(t=>{let r=[...t],n=r.findIndex(e=>"ai"===e.type&&"..."===e.content&&"Analyzing your response..."===e.feedback);return -1!==n&&r.splice(n,1),[...r,{type:"feedback",content:e,feedback:"Quick learning tip",isTemporary:!0}]}),setTimeout(()=>{b(e=>e.filter(e=>!e.isTemporary))},5e3))}let c="".concat(i.text,"\n\n").concat(i.nextQuestion);b(e=>{let t=[...e],r=t.findIndex(e=>"ai"===e.type&&"..."===e.content&&"Analyzing your response..."===e.feedback);return -1!==r&&t.splice(r,1),[...t,{type:"ai",content:c,feedback:i.feedback,score:i.score,pronunciationTips:i.pronunciationTips,grammarTips:i.grammarTips,suggestions:i.suggestions}]}),W(e=>e.some(e=>e.includes(i.text.substring(0,20)))?e:[...e,c]),F&&await ef(F,e,JSON.stringify({feedback:i.feedback,score:i.score,usedWords:i.usedWords,pronunciationTips:i.pronunciationTips,grammarTips:i.grammarTips,suggestions:i.suggestions})),ex(i.nextQuestion),T(e=>{let t=e.totalScore+i.score,r=e.messagesExchanged+1;return{messagesExchanged:r,correctWords:e.correctWords+i.usedWords.filter(e=>e.used).length,totalScore:t,averageScore:Math.round(t/r)}}),!(S.messagesExchanged>=3)||j.some(e=>e.content.includes("complete this exercise"))||q.some(e=>e.includes("complete this exercise"))||setTimeout(()=>{let e="You're doing great! Would you like to continue practicing or complete this exercise?";b(t=>[...t,{type:"ai",content:e,feedback:'You can say "complete" to finish or continue responding to practice more.'}]),ex(e),W(t=>[...t,e])},7e3)}catch(e){console.error("Error processing response:",e),b(e=>{let t=[...e],r=t.findIndex(e=>"ai"===e.type&&"..."===e.content&&"Analyzing your response..."===e.feedback);-1!==r&&t.splice(r,1);let n="I'm having trouble understanding. Let's try again.";return W(e=>[...e,n]),[...t,{type:"ai",content:n,feedback:"Technical issue occurred. Please try responding again."}]})}},ei=(e,t)=>{if(!Y.current)return;if(P&&H.current){console.log("Already speaking, not starting new utterance"),t&&setTimeout(t,500);return}if(R(!0),Y.current.cancel(),B.current)try{B.current.stop()}catch(e){console.log("Error stopping recognition during AI speech",e)}let r=((e=>{let t=e.match(/[^\.!\?]+[\.!\?]+|\s*$/g)||[],r=[],n=new Set;return t.forEach(e=>{let t=e.trim();if(t.length>0){let e=t.toLowerCase().replace(/\s+/g," ");n.has(e)||(n.add(e),r.push(t))}}),r.join(" ")})(e).match(/[^\.!\?]+[\.!\?]+|\s*$/g)||[]).filter(e=>e.trim().length>0);if(0===r.length){console.log("No speech chunks to process"),R(!1),t&&setTimeout(t,100);return}let n=0,s=()=>{var e;if(n>=r.length){R(!1),H.current=null,t&&setTimeout(t,300);return}let o=new SpeechSynthesisUtterance(r[n]),a=(null==(e=Y.current)?void 0:e.getVoices())||[],i=a.find(e=>e.name===et)||a.find(e=>"en-US"===e.lang);i&&(o.voice=i),o.lang="en-US",o.rate=1,o.pitch=1.1,o.onend=()=>{n++,s()},o.onerror=e=>{console.error("Speech error in chunk ".concat(n,":"),e),n++,s()},H.current=o,Y.current&&Y.current.speak(o)};s();let o=setTimeout(()=>{P&&(R(!1),Y.current&&Y.current.cancel(),t&&t())},3e4);return()=>clearTimeout(o)},ec=async e=>{try{let t=(0,m.c4)();if(!t)throw Error("Authentication required");let r=await fetch("/api/analyze-conversation",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({text:e,topicName:en(n),level:parseInt(o),previousMessages:j.map(e=>({role:"user"===e.type?"user":"assistant",content:e.content}))})});if(429===r.status)return console.warn("Rate limit reached, using fallback response"),el(e);if(!r.ok){let t=await r.json().catch(()=>({}));return console.error("API response error:",r.status,t),el(e)}try{let t=await r.json();if(!t.text||!t.feedback||!t.nextQuestion)return console.error("Invalid API response format:",t),el(e);return t}catch(t){return console.error("Error parsing API response:",t),el(e)}}catch(t){return console.error("API request error:",t),el(e)}},el=e=>({text:"I understand what you're saying. Thank you for sharing your thoughts!",feedback:"Good effort! Keep practicing your conversation skills.",usedWords:k.map(t=>({word:t,used:e.toLowerCase().includes(t.toLowerCase()),context:e.toLowerCase().includes(t.toLowerCase())?'Found "'.concat(t,'" in your response'):void 0})),nextQuestion:eu(),score:200,pronunciationTips:[],grammarTips:[],suggestions:["Try to elaborate more on your ideas"]}),ed=async()=>{y(!0),b([]),R(!1),O(!1),L(!1),W([]),T({messagesExchanged:0,correctWords:0,averageScore:0,totalScore:0});try{let e=await em();if(!e){E("Failed to create conversation session"),y(!1);return}z(e),console.log("Setting sessionId state to: ".concat(e));let t="Welcome to our conversation about ".concat(es(n),"! I'll help you practice English while giving you supportive feedback to improve your speaking skills. Let's begin!");b([{type:"ai",content:t}]);let r=eu();W([t,r]);let s=async()=>{try{if(!e)return console.error("Cannot record first question: sessionId not available"),null;await ex(r,e),b(e=>[...e,{type:"ai",content:r}])}catch(e){console.error("Error recording first question:",e),b(e=>[...e,{type:"ai",content:r}])}};setTimeout(s,500)}catch(e){console.error("Error in startConversation:",e),E("Failed to start conversation. Please try again."),y(!1)}},eu=()=>{let e=n.toLowerCase();for(let[t,r]of Object.entries({history:"What do you think about Israel's historical development?",heritage:"What aspects of cultural heritage interest you most?",innovation:"What Israeli technological innovations are you familiar with?",technology:"How do you think technology is changing our lives?",economy:"What interests you about Israel's economy or startup ecosystem?",entrepreneurship:"What makes a successful entrepreneur in your opinion?",diplomacy:"What do you think about Israel's diplomatic relations with other countries?",relations:"How important is international cooperation?"}))if(e.includes(t))return r;return"What aspects of ".concat(es(n)," interest you the most?")},eg=()=>{if(L(!1),B.current)try{B.current.stop()}catch(e){console.log("Error stopping recognition",e)}Y.current&&Y.current.cancel(),R(!1),G.current&&(clearTimeout(G.current),G.current=null),$.current&&(clearTimeout($.current),$.current=null)},eh=async()=>{y(!1),eg(),b(e=>[...e,{type:"ai",content:"Saving your progress...",feedback:"Please wait while we update your level."}]);try{let e=S.averageScore;if(e<=0&&S.messagesExchanged>0&&(e=Math.round(S.correctWords/S.messagesExchanged*100)),e=Math.max(150,e),i){let t=sessionStorage.getItem("task_start_".concat(i)),r=0;t&&(r=Math.floor((Date.now()-parseInt(t))/1e3));let n=(0,m.c4)();n&&await fetch("/api/tasks",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify({taskId:i,TaskScore:e,DurationTask:r,CompletionDate:new Date().toISOString(),SessionId:M,QuestionsCount:J,MessagesExchanged:S.messagesExchanged})})}window.location.href="/topics"}catch(e){console.error("Error in stopConversation:",e),window.location.href="/topics"}},ep=async()=>{if(!A&&i)try{C(!0),eg();let e=(0,m.c4)();if(!e)throw Error("Authentication required");let t="Great job! You've completed the conversation practice.",r="Your average score: ".concat(S.averageScore,"/400. You showed great improvement in your speaking skills!");b(e=>[...e,{type:"ai",content:t,feedback:r}]),M&&await ex(t,M),ei(t+" "+r,()=>{setTimeout(()=>{window.location.href="/topics"},2e3)});let s=sessionStorage.getItem("task_start_".concat(i)),a=0;s&&(a=Math.floor((Date.now()-parseInt(s))/1e3));try{await fetch("/api/tasks",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({taskId:i,TaskScore:S.averageScore||150,DurationTask:a,CompletionDate:new Date().toISOString(),SessionId:M,QuestionsCount:J,MessagesExchanged:S.messagesExchanged})})}catch(e){console.error("Error completing task:",e)}try{let t=en(n);await fetch("/api/user-level/update",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({topicName:t,currentLevel:parseInt(o||"1"),earnedScore:S.averageScore||150,taskId:i,isCompleted:!0})})}catch(e){console.error("Error updating user level:",e)}}catch(e){console.error("Error completing task:",e)}finally{C(!1)}},em=async()=>{if(!i)return console.error("Cannot create session: missing taskId"),null;let e=d();K.current=e,z(e);try{let t=(0,m.c4)();if(!t)return console.warn("No authentication token available for session creation"),e;let r=await fetch("/api/interactive-session",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({SessionId:e,TaskId:i,SessionType:"conversation"}),signal:AbortSignal.timeout(8e3)});if(!r.ok)return console.error("Interactive session creation failed"),e;let n=await r.json();if(console.log("Interactive session created:",n),n.SessionId&&n.SessionId!==e)return K.current=n.SessionId,z(n.SessionId),n.SessionId;return e}catch(t){return console.error("Error creating interactive session:",t),e}},ex=async(e,t)=>{let r=t||K.current||M;if(!r)return console.error("Cannot record question: missing sessionId"),null;let n=d();_(n),Q(e=>e+1);try{let t=(0,m.c4)();if(!t)return console.warn("No authentication token available for question recording"),n;let s=e.length>1e3?e.substring(0,997)+"...":e,o=await fetch("/api/question",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({QuestionId:n,SessionId:r,QuestionText:s}),signal:AbortSignal.timeout(8e3)});if(!o.ok)return console.error("Question recording failed"),n;let a=await o.json();return console.log("Question recorded successfully:",a),n}catch(e){return console.error("Error recording question:",e),n}},ef=async(e,t,r)=>{if(!e)return console.error("Cannot record answer: missing questionId"),!1;try{let n=(0,m.c4)();if(!n)return console.warn("No authentication token available for answer recording"),!1;let s=t.length>1e3?t.substring(0,997)+"...":t,o=r;if("string"!=typeof r)try{o=JSON.stringify(r)}catch(e){console.warn("Error stringifying feedback, using empty string:",e),o=""}let a=await fetch("/api/question/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify({AnswerText:s,Feedback:o}),signal:AbortSignal.timeout(8e3)});if(!a.ok)return console.error("Answer recording failed"),!1;let i=await a.json();return console.log("Answer recorded successfully:",i),!0}catch(e){return console.error("Error recording answer:",e),!1}};return((0,u.useEffect)(()=>{if(window.speechSynthesis){let e=()=>{let e=window.speechSynthesis.getVoices();if(e.length>0){let t=e.filter(e=>e.lang.includes("en-"));ee(t);let r=t.find(e=>e.name.includes("Female")||e.name.includes("female"));r?er(r.name):t.length>0&&er(t[0].name)}};void 0!==window.speechSynthesis.onvoiceschanged&&(window.speechSynthesis.onvoiceschanged=e),e()}},[]),l||w)?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-yellow-50 via-orange-50 to-red-50 p-6 flex justify-center items-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"inline-block w-16 h-16 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mb-4"}),(0,s.jsx)("p",{className:"text-xl font-medium text-gray-700",children:"Loading conversation..."})]})}):I?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-yellow-50 via-orange-50 to-red-50 p-6 flex justify-center items-center",children:(0,s.jsxs)("div",{className:"max-w-md w-full bg-white p-8 rounded-2xl shadow-xl text-center",children:[(0,s.jsx)("div",{className:"text-red-500 text-5xl mb-4",children:"❌"}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:I}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"We couldn't load the conversation at this time. Please try again later."}),(0,s.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,s.jsx)("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-orange-500 text-white rounded-xl hover:bg-orange-600 transition-all duration-300",children:"Try Again"}),(0,s.jsx)(h(),{href:"/topics",className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition-all duration-300",children:"Back to Topics"})]})]})}):(0,s.jsxs)("div",{className:"jsx-a601612189e0457 min-h-screen bg-gradient-to-br from-yellow-50 via-orange-50 to-red-50 p-6 relative",children:[(0,s.jsx)(a(),{id:"a601612189e0457",children:'@import url("https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700&display=swap");body{font-family:"Rubik",sans-serif}'}),(0,s.jsxs)("h1",{className:"jsx-a601612189e0457 text-3xl font-bold text-center text-gray-800 mb-6 mt-2",children:[es(n)," - Conversation Practice"]}),(0,s.jsxs)("div",{className:"jsx-a601612189e0457 max-w-4xl mx-auto mt-4",children:[!f&&(0,s.jsxs)("div",{className:"jsx-a601612189e0457 bg-white rounded-2xl shadow-xl p-8 mb-8 text-center",children:[(0,s.jsx)("h2",{className:"jsx-a601612189e0457 text-2xl font-bold text-gray-800 mb-4",children:"Conversation Practice"}),(0,s.jsxs)("p",{className:"jsx-a601612189e0457 text-gray-600 mb-6",children:["Practice speaking English about ",(0,s.jsx)("span",{className:"jsx-a601612189e0457 font-bold",children:es(n)}),". Our AI conversation partner will listen to your responses, provide real-time feedback on pronunciation, grammar, and fluency, while helping you improve your speaking skills naturally."]}),(0,s.jsxs)("div",{className:"jsx-a601612189e0457 bg-blue-50 p-4 rounded-lg mb-6",children:[(0,s.jsx)("h3",{className:"jsx-a601612189e0457 text-lg font-semibold text-blue-800 mb-2",children:"What to expect:"}),(0,s.jsxs)("ul",{className:"jsx-a601612189e0457 text-sm text-blue-700 text-left max-w-md mx-auto",children:[(0,s.jsx)("li",{className:"jsx-a601612189e0457",children:"• Real-time pronunciation hints"}),(0,s.jsx)("li",{className:"jsx-a601612189e0457",children:"• Grammar suggestions"}),(0,s.jsx)("li",{className:"jsx-a601612189e0457",children:"• Supportive feedback after each response"}),(0,s.jsx)("li",{className:"jsx-a601612189e0457",children:"• Natural conversation flow"}),(0,s.jsx)("li",{className:"jsx-a601612189e0457",children:"• Score range: 0-400 points per response"})]})]}),k.length>0&&(0,s.jsxs)("div",{className:"jsx-a601612189e0457 mb-6",children:[(0,s.jsx)("h3",{className:"jsx-a601612189e0457 text-xl font-semibold text-gray-700 mb-3",children:"Try to use these words:"}),(0,s.jsx)("div",{className:"jsx-a601612189e0457 flex flex-wrap gap-2 justify-center",children:k.map((e,t)=>(0,s.jsx)("span",{className:"jsx-a601612189e0457 px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm",children:e},t))})]}),(0,s.jsx)("button",{onClick:ed,className:"jsx-a601612189e0457 px-8 py-4 bg-orange-500 text-white text-xl font-bold rounded-full hover:bg-orange-600 transition-colors shadow-lg",children:"Start Conversation"})]}),f&&(0,s.jsxs)("div",{className:"jsx-a601612189e0457",children:[(0,s.jsxs)("div",{className:"jsx-a601612189e0457 flex justify-between items-center mb-4",children:[(0,s.jsx)("button",{onClick:eh,className:"jsx-a601612189e0457 px-6 py-3 bg-red-500 text-white font-bold rounded-xl hover:bg-red-600 transition-colors shadow-lg",children:"End Conversation"}),S.messagesExchanged>=3&&(0,s.jsx)("button",{onClick:ep,disabled:A,className:"jsx-a601612189e0457 px-6 py-3 bg-green-500 text-white font-bold rounded-xl hover:bg-green-600 transition-colors shadow-lg disabled:opacity-50",children:A?"Completing...":"Complete Task"})]}),(0,s.jsxs)("div",{className:"jsx-a601612189e0457 bg-white rounded-2xl shadow-xl p-6 mb-4",children:[(0,s.jsxs)("div",{className:"jsx-a601612189e0457 flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{className:"jsx-a601612189e0457 flex items-center",children:[(0,s.jsx)("div",{className:"jsx-a601612189e0457 "+"w-12 h-12 rounded-full flex items-center justify-center text-xl ".concat(P?"bg-green-100 animate-pulse":U?"bg-red-100 animate-pulse":"bg-orange-100"),children:P?"\uD83D\uDD0A":U?"\uD83C\uDF99️":"\uD83D\uDCAC"}),(0,s.jsxs)("div",{className:"jsx-a601612189e0457 ml-4",children:[(0,s.jsx)("h2",{className:"jsx-a601612189e0457 text-xl font-bold text-gray-900",children:"AI Conversation Partner"}),(0,s.jsx)("p",{className:"jsx-a601612189e0457 text-gray-500 text-sm",children:P?"AI is speaking... Please listen":U?"Your turn to speak - Microphone active":f?"Processing...":"Click Start to begin"})]})]}),S.messagesExchanged>0&&(0,s.jsxs)("div",{className:"jsx-a601612189e0457 bg-gray-100 px-4 py-2 rounded-lg",children:[(0,s.jsx)("div",{className:"jsx-a601612189e0457 text-sm text-gray-500",children:"Your score"}),(0,s.jsxs)("div",{className:"jsx-a601612189e0457 text-2xl font-bold text-orange-600",children:[S.averageScore,"/400"]})]})]}),(0,s.jsxs)("div",{className:"jsx-a601612189e0457 space-y-4 max-h-[400px] overflow-y-auto mb-4",children:[j.map((e,t)=>(0,s.jsxs)("div",{className:"jsx-a601612189e0457 "+"p-4 rounded-lg ".concat("user"===e.type?"bg-orange-100 ml-12":"feedback"===e.type?"bg-green-50 border border-green-200":e.content.includes("Microphone is active")?"bg-red-50 border border-red-200":"bg-gray-100 mr-12"),children:["feedback"===e.type&&(0,s.jsxs)("div",{className:"jsx-a601612189e0457 flex items-start",children:[(0,s.jsx)("div",{className:"jsx-a601612189e0457 text-green-500 mr-2 text-lg",children:"\uD83D\uDCA1"}),(0,s.jsxs)("div",{className:"jsx-a601612189e0457 flex-1",children:[(0,s.jsx)("p",{className:"jsx-a601612189e0457 text-sm font-medium text-green-700",children:"Learning Feedback:"}),(0,s.jsx)("p",{className:"jsx-a601612189e0457 text-sm text-green-800 whitespace-pre-line",children:e.content})]})]}),"ai"===e.type&&e.content.includes("Microphone is active")?(0,s.jsxs)("div",{className:"jsx-a601612189e0457 flex items-center",children:[(0,s.jsx)("div",{className:"jsx-a601612189e0457 w-6 h-6 bg-red-500 rounded-full animate-pulse mr-2"}),(0,s.jsx)("p",{className:"jsx-a601612189e0457 text-gray-800 font-medium",children:e.content})]}):"feedback"!==e.type&&(0,s.jsx)("p",{className:"jsx-a601612189e0457 text-gray-800",children:e.content}),e.feedback&&"feedback"!==e.type&&(0,s.jsx)("p",{className:"jsx-a601612189e0457 mt-2 text-sm text-orange-600 italic",children:e.feedback}),void 0!==e.score&&(0,s.jsxs)("div",{className:"jsx-a601612189e0457 mt-2 flex items-center",children:[(0,s.jsx)("span",{className:"jsx-a601612189e0457 text-sm text-gray-500 mr-2",children:"Score:"}),(0,s.jsxs)("span",{className:"jsx-a601612189e0457 "+"text-sm font-medium ".concat(e.score>=320?"text-green-600":e.score>=240?"text-orange-600":"text-red-600"),children:[e.score,"/400"]})]})]},t)),(0,s.jsx)("div",{ref:V,className:"jsx-a601612189e0457"})]}),(0,s.jsxs)("div",{className:"jsx-a601612189e0457 mt-4 bg-gray-50 p-3 rounded-lg border border-gray-200",children:[(0,s.jsx)("h3",{className:"jsx-a601612189e0457 text-sm font-medium text-gray-700 mb-2",children:"Conversation Status:"}),(0,s.jsxs)("div",{className:"jsx-a601612189e0457 flex flex-wrap items-center gap-4 justify-between",children:[(0,s.jsxs)("div",{className:"jsx-a601612189e0457 flex items-center",children:[(0,s.jsx)("div",{className:"jsx-a601612189e0457 "+"w-3 h-3 rounded-full mr-2 ".concat(P?"bg-green-500 animate-pulse":"bg-gray-300")}),(0,s.jsx)("span",{className:"jsx-a601612189e0457 text-sm text-gray-600",children:"AI Speaking"})]}),(0,s.jsxs)("div",{className:"jsx-a601612189e0457 flex items-center",children:[(0,s.jsx)("div",{className:"jsx-a601612189e0457 "+"w-3 h-3 rounded-full mr-2 ".concat(U?"bg-red-500 animate-pulse":"bg-gray-300")}),(0,s.jsx)("span",{className:"jsx-a601612189e0457 text-sm text-gray-600",children:"Your Turn to Speak"})]}),(0,s.jsxs)("div",{className:"jsx-a601612189e0457 flex items-center",children:[(0,s.jsx)("div",{className:"jsx-a601612189e0457 "+"w-3 h-3 rounded-full mr-2 ".concat(D?"bg-orange-500 animate-pulse":"bg-gray-300")}),(0,s.jsx)("span",{className:"jsx-a601612189e0457 text-sm text-gray-600",children:"Speech Detected"})]})]})]}),f&&(0,s.jsxs)("div",{className:"jsx-a601612189e0457 mt-4 bg-gray-50 p-3 rounded-lg border border-gray-200",children:[(0,s.jsx)("h3",{className:"jsx-a601612189e0457 text-sm font-medium text-gray-700 mb-2",children:"Voice Settings:"}),(0,s.jsxs)("div",{className:"jsx-a601612189e0457 flex items-center",children:[(0,s.jsx)("span",{className:"jsx-a601612189e0457 text-sm text-gray-600 mr-2",children:"Voice:"}),(0,s.jsx)("select",{value:et,onChange:e=>er(e.target.value),className:"jsx-a601612189e0457 px-2 py-1 border border-gray-300 rounded text-sm",children:Z.map(e=>(0,s.jsx)("option",{value:e.name,className:"jsx-a601612189e0457",children:e.name},e.name))})]})]})]}),k.length>0&&(0,s.jsxs)("div",{className:"jsx-a601612189e0457 bg-white rounded-2xl shadow-xl p-6",children:[(0,s.jsx)("h3",{className:"jsx-a601612189e0457 text-lg font-semibold text-gray-700 mb-3",children:"Try to use these words:"}),(0,s.jsx)("div",{className:"jsx-a601612189e0457 flex flex-wrap gap-2",children:k.map((e,t)=>(0,s.jsx)("span",{className:"jsx-a601612189e0457 px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm",children:e},t))})]})]})]})]})}AbortSignal.timeout||(AbortSignal.timeout=function(e){let t=new AbortController;return setTimeout(()=>t.abort(new DOMException("TimeoutError","TimeoutError")),e),t.signal})},62794:(e,t,r)=>{Promise.resolve().then(r.bind(r,10011))}},e=>{var t=t=>e(e.s=t);e.O(0,[9268,6874,640,4579,8441,1684,7358],()=>t(62794)),_N_E=e.O()}]);