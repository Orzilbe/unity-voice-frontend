(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3255],{10011:(e,t,r)=>{"use strict";let n;r.r(t),r.d(t,{default:()=>y});var o=r(95155),s=r(11518),a=r.n(s);let i={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},c=new Uint8Array(16),l=[];for(let e=0;e<256;++e)l.push((e+256).toString(16).slice(1));let d=function(e,t,r){if(i.randomUUID&&!t&&!e)return i.randomUUID();let o=(e=e||{}).random??e.rng?.()??function(){if(!n){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");n=crypto.getRandomValues.bind(crypto)}return n(c)}();if(o.length<16)throw Error("Random bytes length must be >= 16");if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=o[e];return t}return function(e,t=0){return(l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]).toLowerCase()}(o)};var u=r(12115),g=r(6874),h=r.n(g),p=r(35695),m=r(79323),x=r(66681),f=r(13105);function y(){let e=(0,p.useRouter)(),t=(0,p.useParams)(),r=(0,p.useSearchParams)(),n=null==t?void 0:t.topicName,s=(null==r?void 0:r.get("level"))||"1",i=null==r?void 0:r.get("taskId"),{isAuthenticated:c,isLoading:l,user:g}=(0,x.A)(),[y,j]=(0,u.useState)(!1),[b,v]=(0,u.useState)([]),[w,k]=(0,u.useState)(!0),[N,S]=(0,u.useState)([]),[T,I]=(0,u.useState)({messagesExchanged:0,correctWords:0,averageScore:0,totalScore:0}),[E,C]=(0,u.useState)(null),[A,P]=(0,u.useState)(!1),[R,D]=(0,u.useState)(!1),[O,U]=(0,u.useState)(!1),[L,q]=(0,u.useState)(!1),[W,M]=(0,u.useState)([]),[z,F]=(0,u.useState)(null),[_,J]=(0,u.useState)(null),[Q,B]=(0,u.useState)(0),Y=(0,u.useRef)(null),V=(0,u.useRef)(null),G=(0,u.useRef)(null),$=(0,u.useRef)(null),H=(0,u.useRef)(null),K=(0,u.useRef)(null),X=(0,u.useRef)(null),Z=(0,u.useRef)(null),[ee,et]=(0,u.useState)([]),[er,en]=(0,u.useState)("");(0,u.useEffect)(()=>{(async()=>{if(c)if(!i&&n&&s)try{let t=(0,m.c4)();if(!t)throw Error("Authentication required");console.log("Creating new conversation task"),console.log("Topic Name:",n),console.log("Formatted Topic Name:",eo(n)),console.log("Level:",s);let r=await (0,f.v)("/api/tasks",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({TopicName:eo(n),Level:parseInt(s),TaskType:"conversation"})});if(console.log("API Response status:",r.status),!r.ok){let e=await r.text();console.error("API Error Response:",e);let t="Failed to create conversation task";try{let r=JSON.parse(e);t=r.message||r.error||t}catch(e){}throw Error(t)}let o=await r.json();if(console.log("Created conversation task:",o),o.TaskId){let t="/topics/".concat(n,"/tasks/conversation?level=").concat(s,"&taskId=").concat(o.TaskId);console.log("Redirecting to:",t),sessionStorage.setItem("task_start_".concat(o.TaskId),Date.now().toString()),e.push(t)}else throw Error("No TaskId returned from server")}catch(e){console.error("Error creating conversation task:",e),C("Failed to initialize conversation task: ".concat(e instanceof Error?e.message:"Unknown error"))}else i&&sessionStorage.setItem("task_start_".concat(i),Date.now().toString())})()},[c,i,n,s,e]),(0,u.useEffect)(()=>{!l&&c&&!i&&n&&s&&console.log("No taskId found in URL, need to create or redirect")},[l,c,i,n,s]),(0,u.useEffect)(()=>{try{let e=window.SpeechRecognition||window.webkitSpeechRecognition;e&&(Y.current=new e,Y.current.continuous=!1,Y.current.interimResults=!0,Y.current.lang="en-US",Y.current.onresult=e=>{let t=e.results[e.results.length-1];if(t.isFinal){let e=t[0].transcript.trim();if(e.length>1){var r;let t=(null==(r=b.find(e=>"ai"===e.type))?void 0:r.content)||"";if(function(e,t){let r=e.toLowerCase().replace(/[^\w\s]/g,""),n=t.toLowerCase().replace(/[^\w\s]/g,""),o=r.split(/\s+/).filter(e=>e.length>2),s=n.split(/\s+/).filter(e=>e.length>2);if(0===o.length||0===s.length)return 0;let a=0,i=Math.min(6,Math.min(o.length,s.length)),c=0;for(let e=0;e<i;e++)e<o.length&&e<s.length&&o[e]===s[e]&&c++;if(c>=3||i>0&&c/i>=.5)return .9;for(let e of o)s.includes(e)&&e.length>3&&a++;return a/Math.max(o.length,1)}(e,t)>.7)return void console.log("Detected echo of AI's own speech, ignoring");console.log("Final transcript:",e),ei(e)}}},Y.current.onstart=()=>{console.log("Recognition started"),U(!1)},Y.current.onspeechstart=()=>{console.log("Speech detected"),U(!0),H.current&&(clearTimeout(H.current),H.current=null)},Y.current.onspeechend=()=>{console.log("Speech ended"),H.current=window.setTimeout(()=>{U(!1);try{Y.current.stop()}catch(e){console.log("Error stopping recognition",e)}},1e3)},Y.current.onend=()=>{if(console.log("Recognition ended"),L&&!O){console.log("Restarting recognition");try{Y.current.start()}catch(e){console.log("Error restarting recognition",e),setTimeout(()=>{if(L)try{Y.current.start()}catch(e){console.log("Failed to restart recognition again",e)}},500)}}},Y.current.onerror=e=>{if(console.error("Recognition error:",e.error),"no-speech"===e.error&&L)try{Y.current.stop(),setTimeout(()=>{if(L)try{Y.current.start(),v(e=>e.some(e=>"ai"===e.type&&e.content.includes("waiting for your response"))?e:[...e,{type:"ai",content:"I'm waiting for your response. Please speak clearly when the microphone is active.",feedback:"Microphone is listening"}])}catch(e){console.log("Error restarting after no-speech",e)}},300)}catch(e){console.log("Error handling no-speech",e)}}),V.current=window.speechSynthesis}catch(e){console.error("Error initializing speech APIs:",e),C("Speech recognition not available in your browser")}return()=>{if(Y.current)try{Y.current.stop()}catch(e){console.log("Error stopping recognition on cleanup",e)}V.current&&V.current.cancel(),[$.current,H.current,Z.current].forEach(e=>{e&&clearTimeout(e)})}},[]),(0,u.useEffect)(()=>{(async()=>{if(c&&n)try{k(!0),C(null);let e=(0,m.c4)();if(!e)throw Error("Authentication required");try{let t=await (0,f.v)("/api/words/required?topic=".concat(encodeURIComponent(eo(n)),"&level=").concat(s),{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();console.log("Required words response:",e),e.success&&Array.isArray(e.data)?(S(e.data),console.log("Loaded ".concat(e.data.length," required words"))):Array.isArray(e)?S(e):(console.warn("No required words found for this topic and level"),S([]))}else console.error("Failed to fetch required words:",t.status),S([])}catch(e){console.error("Error loading required words:",e),S([])}}catch(e){console.error("Error loading initial data:",e),C(e instanceof Error?e.message:"Failed to load data")}finally{k(!1)}})()},[c,n,s]),(0,u.useEffect)(()=>{var e;null==(e=G.current)||e.scrollIntoView({behavior:"smooth"})},[b]),(0,u.useEffect)(()=>{if(W.length>0&&!R&&y){let e=W[0];M(e=>e.slice(1)),ec(e,()=>{W.length<=1&&y&&setTimeout(()=>{q(!0),ea()},500)})}},[W,R,y]);let eo=e=>e.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),es=e=>eo(e),ea=()=>{if(Y.current)try{console.log("Activating microphone"),Y.current.start(),v(e=>{let t=e[e.length-1];return t&&"ai"===t.type&&t.content.includes("Microphone is active")?e:[...e,{type:"ai",content:"\uD83C\uDFA4 Microphone is active. Please speak now.",feedback:"Your turn to speak"}]}),$.current&&clearTimeout($.current),$.current=window.setTimeout(()=>{if(L&&!O){try{var e;null==(e=Y.current)||e.stop(),q(!1)}catch(e){console.log("Error stopping recognition on timeout",e)}let t="I didn't hear your response. Let's move on to the next question.";v(e=>[...e,{type:"ai",content:t}]),M(e=>[...e,t,"Let's try again. "+eg()])}},2e4)}catch(e){console.error("Could not start speech recognition:",e),v(e=>[...e,{type:"ai",content:"I'm having trouble with the microphone. Please try refreshing the page.",feedback:"Microphone error"}])}},ei=async e=>{q(!1),U(!1),Z.current&&clearTimeout(Z.current),Z.current=window.setTimeout(()=>{if(L&&y){let e="Are you still there? I'm waiting for your response.";v(t=>[...t,{type:"ai",content:e}]),M(t=>[...t,e])}},3e4);try{Y.current&&Y.current.stop()}catch(e){console.log("Error stopping recognition after response",e)}v(t=>[...t,{type:"user",content:e}]);try{var t,r,n,o,s,a;v(e=>[...e,{type:"ai",content:"...",feedback:"Analyzing your response..."}]);let i=await el(e);if((null==(t=i.pronunciationTips)?void 0:t.length)||(null==(r=i.grammarTips)?void 0:r.length)||(null==(n=i.suggestions)?void 0:n.length)){let e="";(null==(o=i.pronunciationTips)?void 0:o.length)&&(e+="\uD83D\uDCA1 Pronunciation: ".concat(i.pronunciationTips[0],"\n")),(null==(s=i.grammarTips)?void 0:s.length)&&(e+="✍️ Grammar: ".concat(i.grammarTips[0],"\n")),(null==(a=i.suggestions)?void 0:a.length)&&(e+="\uD83D\uDCAD Suggestion: ".concat(i.suggestions[0])),e&&(v(t=>{let r=[...t],n=r.findIndex(e=>"ai"===e.type&&"..."===e.content&&"Analyzing your response..."===e.feedback);return -1!==n&&r.splice(n,1),[...r,{type:"feedback",content:e,feedback:"Quick learning tip",isTemporary:!0}]}),setTimeout(()=>{v(e=>e.filter(e=>!e.isTemporary))},5e3))}let c="".concat(i.text,"\n\n").concat(i.nextQuestion);v(e=>{let t=[...e],r=t.findIndex(e=>"ai"===e.type&&"..."===e.content&&"Analyzing your response..."===e.feedback);return -1!==r&&t.splice(r,1),[...t,{type:"ai",content:c,feedback:i.feedback,score:i.score,pronunciationTips:i.pronunciationTips,grammarTips:i.grammarTips,suggestions:i.suggestions}]}),M(e=>e.some(e=>e.includes(i.text.substring(0,20)))?e:[...e,c]),_&&await ey(_,e,JSON.stringify({feedback:i.feedback,score:i.score,usedWords:i.usedWords,pronunciationTips:i.pronunciationTips,grammarTips:i.grammarTips,suggestions:i.suggestions})),ef(i.nextQuestion),I(e=>{let t=e.totalScore+i.score,r=e.messagesExchanged+1;return{messagesExchanged:r,correctWords:e.correctWords+i.usedWords.filter(e=>e.used).length,totalScore:t,averageScore:Math.round(t/r)}}),!(T.messagesExchanged>=3)||b.some(e=>e.content.includes("complete this exercise"))||W.some(e=>e.includes("complete this exercise"))||setTimeout(()=>{let e="You're doing great! Would you like to continue practicing or complete this exercise?";v(t=>[...t,{type:"ai",content:e,feedback:'You can say "complete" to finish or continue responding to practice more.'}]),ef(e),M(t=>[...t,e])},7e3)}catch(e){console.error("Error processing response:",e),v(e=>{let t=[...e],r=t.findIndex(e=>"ai"===e.type&&"..."===e.content&&"Analyzing your response..."===e.feedback);-1!==r&&t.splice(r,1);let n="I'm having trouble understanding. Let's try again.";return M(e=>[...e,n]),[...t,{type:"ai",content:n,feedback:"Technical issue occurred. Please try responding again."}]})}},ec=(e,t)=>{if(!V.current)return;if(R&&K.current){console.log("Already speaking, not starting new utterance"),t&&setTimeout(t,500);return}if(D(!0),V.current.cancel(),Y.current)try{Y.current.stop()}catch(e){console.log("Error stopping recognition during AI speech",e)}let r=((e=>{let t=e.match(/[^\.!\?]+[\.!\?]+|\s*$/g)||[],r=[],n=new Set;return t.forEach(e=>{let t=e.trim();if(t.length>0){let e=t.toLowerCase().replace(/\s+/g," ");n.has(e)||(n.add(e),r.push(t))}}),r.join(" ")})(e).match(/[^\.!\?]+[\.!\?]+|\s*$/g)||[]).filter(e=>e.trim().length>0);if(0===r.length){console.log("No speech chunks to process"),D(!1),t&&setTimeout(t,100);return}let n=0,o=()=>{var e;if(n>=r.length){D(!1),K.current=null,t&&setTimeout(t,300);return}let s=new SpeechSynthesisUtterance(r[n]),a=(null==(e=V.current)?void 0:e.getVoices())||[],i=a.find(e=>e.name===er)||a.find(e=>"en-US"===e.lang);i&&(s.voice=i),s.lang="en-US",s.rate=1,s.pitch=1.1,s.onend=()=>{n++,o()},s.onerror=e=>{console.error("Speech error in chunk ".concat(n,":"),e),n++,o()},K.current=s,V.current&&V.current.speak(s)};o();let s=setTimeout(()=>{R&&(D(!1),V.current&&V.current.cancel(),t&&t())},3e4);return()=>clearTimeout(s)},el=async e=>{try{let t=(0,m.c4)();if(!t)throw Error("Authentication required");let r=await (0,f.v)("/api/analyze-conversation",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({text:e,topicName:eo(n),level:parseInt(s),previousMessages:b.map(e=>({role:"user"===e.type?"user":"assistant",content:e.content}))})});if(429===r.status)return console.warn("Rate limit reached, using fallback response"),ed(e);if(!r.ok){let t=await r.json().catch(()=>({}));return console.error("API response error:",r.status,t),ed(e)}try{let t=await r.json();if(!t.text||!t.feedback||!t.nextQuestion)return console.error("Invalid API response format:",t),ed(e);return t}catch(t){return console.error("Error parsing API response:",t),ed(e)}}catch(t){return console.error("API request error:",t),ed(e)}},ed=e=>({text:"I understand what you're saying. Thank you for sharing your thoughts!",feedback:"Good effort! Keep practicing your conversation skills.",usedWords:N.map(t=>({word:t,used:e.toLowerCase().includes(t.toLowerCase()),context:e.toLowerCase().includes(t.toLowerCase())?'Found "'.concat(t,'" in your response'):void 0})),nextQuestion:eg(),score:200,pronunciationTips:[],grammarTips:[],suggestions:["Try to elaborate more on your ideas"]}),eu=async()=>{j(!0),v([]),D(!1),U(!1),q(!1),M([]),I({messagesExchanged:0,correctWords:0,averageScore:0,totalScore:0});try{let e=await ex();if(!e){C("Failed to create conversation session"),j(!1);return}F(e),console.log("Setting sessionId state to: ".concat(e));let t="Welcome to our conversation about ".concat(es(n),"! I'll help you practice English while giving you supportive feedback to improve your speaking skills. Let's begin!");v([{type:"ai",content:t}]);let r=eg();M([t,r]);let o=async()=>{try{if(!e)return console.error("Cannot record first question: sessionId not available"),null;await ef(r,e),v(e=>[...e,{type:"ai",content:r}])}catch(e){console.error("Error recording first question:",e),v(e=>[...e,{type:"ai",content:r}])}};setTimeout(o,500)}catch(e){console.error("Error in startConversation:",e),C("Failed to start conversation. Please try again."),j(!1)}},eg=()=>{let e=n.toLowerCase();for(let[t,r]of Object.entries({history:"What do you think about Israel's historical development?",heritage:"What aspects of cultural heritage interest you most?",innovation:"What Israeli technological innovations are you familiar with?",technology:"How do you think technology is changing our lives?",economy:"What interests you about Israel's economy or startup ecosystem?",entrepreneurship:"What makes a successful entrepreneur in your opinion?",diplomacy:"What do you think about Israel's diplomatic relations with other countries?",relations:"How important is international cooperation?"}))if(e.includes(t))return r;return"What aspects of ".concat(es(n)," interest you the most?")},eh=()=>{if(q(!1),Y.current)try{Y.current.stop()}catch(e){console.log("Error stopping recognition",e)}V.current&&V.current.cancel(),D(!1),$.current&&(clearTimeout($.current),$.current=null),H.current&&(clearTimeout(H.current),H.current=null)},ep=async()=>{j(!1),eh(),v(e=>[...e,{type:"ai",content:"Saving your progress...",feedback:"Please wait while we update your level."}]);try{let e=T.averageScore;if(e<=0&&T.messagesExchanged>0&&(e=Math.round(T.correctWords/T.messagesExchanged*100)),e=Math.max(150,e),i){let t=sessionStorage.getItem("task_start_".concat(i)),r=0;t&&(r=Math.floor((Date.now()-parseInt(t))/1e3));let n=(0,m.c4)();n&&await (0,f.v)("/api/tasks",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify({taskId:i,TaskScore:e,DurationTask:r,CompletionDate:new Date().toISOString(),SessionId:z,QuestionsCount:Q,MessagesExchanged:T.messagesExchanged})})}window.location.href="/topics"}catch(e){console.error("Error in stopConversation:",e),window.location.href="/topics"}},em=async()=>{if(!A&&i)try{P(!0),eh();let e=(0,m.c4)();if(!e)throw Error("Authentication required");let t="Great job! You've completed the conversation practice.",r="Your average score: ".concat(T.averageScore,"/400. You showed great improvement in your speaking skills!");v(e=>[...e,{type:"ai",content:t,feedback:r}]),z&&await ef(t,z),ec(t+" "+r,()=>{setTimeout(()=>{window.location.href="/topics"},2e3)});let o=sessionStorage.getItem("task_start_".concat(i)),a=0;o&&(a=Math.floor((Date.now()-parseInt(o))/1e3));try{await (0,f.v)("/api/tasks",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({taskId:i,TaskScore:T.averageScore||150,DurationTask:a,CompletionDate:new Date().toISOString(),SessionId:z,QuestionsCount:Q,MessagesExchanged:T.messagesExchanged})})}catch(e){console.error("Error completing task:",e)}try{let t=eo(n);await (0,f.v)("/api/user-level/update",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({topicName:t,currentLevel:parseInt(s||"1"),earnedScore:T.averageScore||150,taskId:i,isCompleted:!0})})}catch(e){console.error("Error updating user level:",e)}}catch(e){console.error("Error completing task:",e)}finally{P(!1)}},ex=async()=>{if(!i)return console.error("Cannot create session: missing taskId"),null;let e=d();X.current=e,F(e);try{let t=(0,m.c4)();if(!t)return console.warn("No authentication token available for session creation"),e;let r=await (0,f.v)("/api/interactive-session",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({SessionId:e,TaskId:i,SessionType:"conversation"}),signal:AbortSignal.timeout(8e3)});if(!r.ok)return console.error("Interactive session creation failed"),e;let n=await r.json();if(console.log("Interactive session created:",n),n.SessionId&&n.SessionId!==e)return X.current=n.SessionId,F(n.SessionId),n.SessionId;return e}catch(t){return console.error("Error creating interactive session:",t),e}},ef=async(e,t)=>{let r=t||X.current||z;if(!r)return console.error("Cannot record question: missing sessionId"),null;let n=d();J(n),B(e=>e+1);try{let t=(0,m.c4)();if(!t)return console.warn("No authentication token available for question recording"),n;let o=e.length>1e3?e.substring(0,997)+"...":e,s=await (0,f.v)("/api/question",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({QuestionId:n,SessionId:r,QuestionText:o}),signal:AbortSignal.timeout(8e3)});if(!s.ok)return console.error("Question recording failed"),n;let a=await s.json();return console.log("Question recorded successfully:",a),n}catch(e){return console.error("Error recording question:",e),n}},ey=async(e,t,r)=>{if(!e)return console.error("Cannot record answer: missing questionId"),!1;try{let n=(0,m.c4)();if(!n)return console.warn("No authentication token available for answer recording"),!1;let o=t.length>1e3?t.substring(0,997)+"...":t,s=r;if("string"!=typeof r)try{s=JSON.stringify(r)}catch(e){console.warn("Error stringifying feedback, using empty string:",e),s=""}let a=await (0,f.v)("/api/question/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify({AnswerText:o,Feedback:s}),signal:AbortSignal.timeout(8e3)});if(!a.ok)return console.error("Answer recording failed"),!1;let i=await a.json();return console.log("Answer recorded successfully:",i),!0}catch(e){return console.error("Error recording answer:",e),!1}};return((0,u.useEffect)(()=>{if(window.speechSynthesis){let e=()=>{let e=window.speechSynthesis.getVoices();if(e.length>0){let t=e.filter(e=>e.lang.includes("en-"));et(t);let r=t.find(e=>e.name.includes("Female")||e.name.includes("female"));r?en(r.name):t.length>0&&en(t[0].name)}};void 0!==window.speechSynthesis.onvoiceschanged&&(window.speechSynthesis.onvoiceschanged=e),e()}},[]),l||w)?(0,o.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-yellow-50 via-orange-50 to-red-50 p-6 flex justify-center items-center",children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"inline-block w-16 h-16 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mb-4"}),(0,o.jsx)("p",{className:"text-xl font-medium text-gray-700",children:"Loading conversation..."})]})}):E?(0,o.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-yellow-50 via-orange-50 to-red-50 p-6 flex justify-center items-center",children:(0,o.jsxs)("div",{className:"max-w-md w-full bg-white p-8 rounded-2xl shadow-xl text-center",children:[(0,o.jsx)("div",{className:"text-red-500 text-5xl mb-4",children:"❌"}),(0,o.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:E}),(0,o.jsx)("p",{className:"text-gray-600 mb-6",children:"We couldn't load the conversation at this time. Please try again later."}),(0,o.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,o.jsx)("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-orange-500 text-white rounded-xl hover:bg-orange-600 transition-all duration-300",children:"Try Again"}),(0,o.jsx)(h(),{href:"/topics",className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition-all duration-300",children:"Back to Topics"})]})]})}):(0,o.jsxs)("div",{className:"jsx-a601612189e0457 min-h-screen bg-gradient-to-br from-yellow-50 via-orange-50 to-red-50 p-6 relative",children:[(0,o.jsx)(a(),{id:"a601612189e0457",children:'@import url("https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700&display=swap");body{font-family:"Rubik",sans-serif}'}),(0,o.jsxs)("h1",{className:"jsx-a601612189e0457 text-3xl font-bold text-center text-gray-800 mb-6 mt-2",children:[es(n)," - Conversation Practice"]}),(0,o.jsxs)("div",{className:"jsx-a601612189e0457 max-w-4xl mx-auto mt-4",children:[!y&&(0,o.jsxs)("div",{className:"jsx-a601612189e0457 bg-white rounded-2xl shadow-xl p-8 mb-8 text-center",children:[(0,o.jsx)("h2",{className:"jsx-a601612189e0457 text-2xl font-bold text-gray-800 mb-4",children:"Conversation Practice"}),(0,o.jsxs)("p",{className:"jsx-a601612189e0457 text-gray-600 mb-6",children:["Practice speaking English about ",(0,o.jsx)("span",{className:"jsx-a601612189e0457 font-bold",children:es(n)}),". Our AI conversation partner will listen to your responses, provide real-time feedback on pronunciation, grammar, and fluency, while helping you improve your speaking skills naturally."]}),(0,o.jsxs)("div",{className:"jsx-a601612189e0457 bg-blue-50 p-4 rounded-lg mb-6",children:[(0,o.jsx)("h3",{className:"jsx-a601612189e0457 text-lg font-semibold text-blue-800 mb-2",children:"What to expect:"}),(0,o.jsxs)("ul",{className:"jsx-a601612189e0457 text-sm text-blue-700 text-left max-w-md mx-auto",children:[(0,o.jsx)("li",{className:"jsx-a601612189e0457",children:"• Real-time pronunciation hints"}),(0,o.jsx)("li",{className:"jsx-a601612189e0457",children:"• Grammar suggestions"}),(0,o.jsx)("li",{className:"jsx-a601612189e0457",children:"• Supportive feedback after each response"}),(0,o.jsx)("li",{className:"jsx-a601612189e0457",children:"• Natural conversation flow"}),(0,o.jsx)("li",{className:"jsx-a601612189e0457",children:"• Score range: 0-400 points per response"})]})]}),N.length>0&&(0,o.jsxs)("div",{className:"jsx-a601612189e0457 mb-6",children:[(0,o.jsx)("h3",{className:"jsx-a601612189e0457 text-xl font-semibold text-gray-700 mb-3",children:"Try to use these words:"}),(0,o.jsx)("div",{className:"jsx-a601612189e0457 flex flex-wrap gap-2 justify-center",children:N.map((e,t)=>(0,o.jsx)("span",{className:"jsx-a601612189e0457 px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm",children:e},t))})]}),(0,o.jsx)("button",{onClick:eu,className:"jsx-a601612189e0457 px-8 py-4 bg-orange-500 text-white text-xl font-bold rounded-full hover:bg-orange-600 transition-colors shadow-lg",children:"Start Conversation"})]}),y&&(0,o.jsxs)("div",{className:"jsx-a601612189e0457",children:[(0,o.jsxs)("div",{className:"jsx-a601612189e0457 flex justify-between items-center mb-4",children:[(0,o.jsx)("button",{onClick:ep,className:"jsx-a601612189e0457 px-6 py-3 bg-red-500 text-white font-bold rounded-xl hover:bg-red-600 transition-colors shadow-lg",children:"End Conversation"}),T.messagesExchanged>=3&&(0,o.jsx)("button",{onClick:em,disabled:A,className:"jsx-a601612189e0457 px-6 py-3 bg-green-500 text-white font-bold rounded-xl hover:bg-green-600 transition-colors shadow-lg disabled:opacity-50",children:A?"Completing...":"Complete Task"})]}),(0,o.jsxs)("div",{className:"jsx-a601612189e0457 bg-white rounded-2xl shadow-xl p-6 mb-4",children:[(0,o.jsxs)("div",{className:"jsx-a601612189e0457 flex items-center justify-between mb-6",children:[(0,o.jsxs)("div",{className:"jsx-a601612189e0457 flex items-center",children:[(0,o.jsx)("div",{className:"jsx-a601612189e0457 "+"w-12 h-12 rounded-full flex items-center justify-center text-xl ".concat(R?"bg-green-100 animate-pulse":L?"bg-red-100 animate-pulse":"bg-orange-100"),children:R?"\uD83D\uDD0A":L?"\uD83C\uDF99️":"\uD83D\uDCAC"}),(0,o.jsxs)("div",{className:"jsx-a601612189e0457 ml-4",children:[(0,o.jsx)("h2",{className:"jsx-a601612189e0457 text-xl font-bold text-gray-900",children:"AI Conversation Partner"}),(0,o.jsx)("p",{className:"jsx-a601612189e0457 text-gray-500 text-sm",children:R?"AI is speaking... Please listen":L?"Your turn to speak - Microphone active":y?"Processing...":"Click Start to begin"})]})]}),T.messagesExchanged>0&&(0,o.jsxs)("div",{className:"jsx-a601612189e0457 bg-gray-100 px-4 py-2 rounded-lg",children:[(0,o.jsx)("div",{className:"jsx-a601612189e0457 text-sm text-gray-500",children:"Your score"}),(0,o.jsxs)("div",{className:"jsx-a601612189e0457 text-2xl font-bold text-orange-600",children:[T.averageScore,"/400"]})]})]}),(0,o.jsxs)("div",{className:"jsx-a601612189e0457 space-y-4 max-h-[400px] overflow-y-auto mb-4",children:[b.map((e,t)=>(0,o.jsxs)("div",{className:"jsx-a601612189e0457 "+"p-4 rounded-lg ".concat("user"===e.type?"bg-orange-100 ml-12":"feedback"===e.type?"bg-green-50 border border-green-200":e.content.includes("Microphone is active")?"bg-red-50 border border-red-200":"bg-gray-100 mr-12"),children:["feedback"===e.type&&(0,o.jsxs)("div",{className:"jsx-a601612189e0457 flex items-start",children:[(0,o.jsx)("div",{className:"jsx-a601612189e0457 text-green-500 mr-2 text-lg",children:"\uD83D\uDCA1"}),(0,o.jsxs)("div",{className:"jsx-a601612189e0457 flex-1",children:[(0,o.jsx)("p",{className:"jsx-a601612189e0457 text-sm font-medium text-green-700",children:"Learning Feedback:"}),(0,o.jsx)("p",{className:"jsx-a601612189e0457 text-sm text-green-800 whitespace-pre-line",children:e.content})]})]}),"ai"===e.type&&e.content.includes("Microphone is active")?(0,o.jsxs)("div",{className:"jsx-a601612189e0457 flex items-center",children:[(0,o.jsx)("div",{className:"jsx-a601612189e0457 w-6 h-6 bg-red-500 rounded-full animate-pulse mr-2"}),(0,o.jsx)("p",{className:"jsx-a601612189e0457 text-gray-800 font-medium",children:e.content})]}):"feedback"!==e.type&&(0,o.jsx)("p",{className:"jsx-a601612189e0457 text-gray-800",children:e.content}),e.feedback&&"feedback"!==e.type&&(0,o.jsx)("p",{className:"jsx-a601612189e0457 mt-2 text-sm text-orange-600 italic",children:e.feedback}),void 0!==e.score&&(0,o.jsxs)("div",{className:"jsx-a601612189e0457 mt-2 flex items-center",children:[(0,o.jsx)("span",{className:"jsx-a601612189e0457 text-sm text-gray-500 mr-2",children:"Score:"}),(0,o.jsxs)("span",{className:"jsx-a601612189e0457 "+"text-sm font-medium ".concat(e.score>=320?"text-green-600":e.score>=240?"text-orange-600":"text-red-600"),children:[e.score,"/400"]})]})]},t)),(0,o.jsx)("div",{ref:G,className:"jsx-a601612189e0457"})]}),(0,o.jsxs)("div",{className:"jsx-a601612189e0457 mt-4 bg-gray-50 p-3 rounded-lg border border-gray-200",children:[(0,o.jsx)("h3",{className:"jsx-a601612189e0457 text-sm font-medium text-gray-700 mb-2",children:"Conversation Status:"}),(0,o.jsxs)("div",{className:"jsx-a601612189e0457 flex flex-wrap items-center gap-4 justify-between",children:[(0,o.jsxs)("div",{className:"jsx-a601612189e0457 flex items-center",children:[(0,o.jsx)("div",{className:"jsx-a601612189e0457 "+"w-3 h-3 rounded-full mr-2 ".concat(R?"bg-green-500 animate-pulse":"bg-gray-300")}),(0,o.jsx)("span",{className:"jsx-a601612189e0457 text-sm text-gray-600",children:"AI Speaking"})]}),(0,o.jsxs)("div",{className:"jsx-a601612189e0457 flex items-center",children:[(0,o.jsx)("div",{className:"jsx-a601612189e0457 "+"w-3 h-3 rounded-full mr-2 ".concat(L?"bg-red-500 animate-pulse":"bg-gray-300")}),(0,o.jsx)("span",{className:"jsx-a601612189e0457 text-sm text-gray-600",children:"Your Turn to Speak"})]}),(0,o.jsxs)("div",{className:"jsx-a601612189e0457 flex items-center",children:[(0,o.jsx)("div",{className:"jsx-a601612189e0457 "+"w-3 h-3 rounded-full mr-2 ".concat(O?"bg-orange-500 animate-pulse":"bg-gray-300")}),(0,o.jsx)("span",{className:"jsx-a601612189e0457 text-sm text-gray-600",children:"Speech Detected"})]})]})]}),y&&(0,o.jsxs)("div",{className:"jsx-a601612189e0457 mt-4 bg-gray-50 p-3 rounded-lg border border-gray-200",children:[(0,o.jsx)("h3",{className:"jsx-a601612189e0457 text-sm font-medium text-gray-700 mb-2",children:"Voice Settings:"}),(0,o.jsxs)("div",{className:"jsx-a601612189e0457 flex items-center",children:[(0,o.jsx)("span",{className:"jsx-a601612189e0457 text-sm text-gray-600 mr-2",children:"Voice:"}),(0,o.jsx)("select",{value:er,onChange:e=>en(e.target.value),className:"jsx-a601612189e0457 px-2 py-1 border border-gray-300 rounded text-sm",children:ee.map(e=>(0,o.jsx)("option",{value:e.name,className:"jsx-a601612189e0457",children:e.name},e.name))})]})]})]}),N.length>0&&(0,o.jsxs)("div",{className:"jsx-a601612189e0457 bg-white rounded-2xl shadow-xl p-6",children:[(0,o.jsx)("h3",{className:"jsx-a601612189e0457 text-lg font-semibold text-gray-700 mb-3",children:"Try to use these words:"}),(0,o.jsx)("div",{className:"jsx-a601612189e0457 flex flex-wrap gap-2",children:N.map((e,t)=>(0,o.jsx)("span",{className:"jsx-a601612189e0457 px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm",children:e},t))})]})]})]})]})}AbortSignal.timeout||(AbortSignal.timeout=function(e){let t=new AbortController;return setTimeout(()=>t.abort(new DOMException("TimeoutError","TimeoutError")),e),t.signal})},13105:(e,t,r)=>{"use strict";async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,{credentials:"include",headers:{"Content-Type":"application/json",...t.headers||{}},...t})}r.d(t,{v:()=>n})},79323:(e,t,r)=>{"use strict";function n(){{let e=localStorage.getItem("token");if(e)return e;for(let e of document.cookie.split(";")){let[t,r]=e.trim().split("=");if("token"===t)return r}}return null}r.d(t,{c4:()=>n}),r(58801),r(41008),r(49509)},99655:(e,t,r)=>{Promise.resolve().then(r.bind(r,10011))}},e=>{var t=t=>e(e.s=t);e.O(0,[9268,6874,640,6681,8441,1684,7358],()=>t(99655)),_N_E=e.O()}]);