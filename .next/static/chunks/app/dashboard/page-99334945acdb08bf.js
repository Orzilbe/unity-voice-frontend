(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{5615:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>P});var a=s(95155),r=s(12115),o=s(66681),l=s(35695),i=s(83540),n=s(8782),c=s(34e3),d=s(54811),u=s(94517),h=s(3401),g=s(94754),x=s(96025),m=s(16238),p=s(24026),y=s(83394),v=s(93504),f=s(21374),j=s(85339),b=s(53904),w=s(91788),N=s(17580),S=s(79397),k=s(69074),A=s(33109),I=s(6874),E=s.n(I);let T=e=>{let{title:t,value:s,icon:r,change:o,changeType:l}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-700",children:t}),(0,a.jsx)(r,{className:"h-6 w-6 text-blue-500"})]}),(0,a.jsxs)("div",{className:"flex items-baseline",children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:s}),void 0!==o&&(0,a.jsxs)("p",{className:"ml-2 text-sm font-medium ".concat("positive"===l?"text-green-600":"text-red-600"),children:["positive"===l?"+":"",o,"%"]})]})]})},L=e=>{let{message:t}=e;return(0,a.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(j.A,{className:"h-5 w-5 mr-2"}),(0,a.jsx)("span",{children:t})]})})},R=()=>{var e,t;let[s,j]=(0,r.useState)(null),[I,R]=(0,r.useState)(!0),[P,U]=(0,r.useState)(null),[O,_]=(0,r.useState)("all"),[C,D]=(0,r.useState)("30d"),{isAuthenticated:F,isLoading:z,user:J}=(0,o.A)(),B=(0,l.useRouter)();(0,r.useEffect)(()=>{z||F||B.push("/login")},[F,z,J,B]),(0,r.useEffect)(()=>{(async()=>{if(F)try{R(!0),U(null);let e=localStorage.getItem("token"),t={Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},[s,a,r,o,l,i]=await Promise.all([fetch("/api/dashboard/user-stats",{headers:t}),fetch("/api/dashboard/users-by-level",{headers:t}),fetch("/api/dashboard/topic-popularity?topic=".concat(O),{headers:t}),fetch("/api/dashboard/user-activity?range=".concat(C),{headers:t}),fetch("/api/dashboard/completion-rates",{headers:t}),fetch("/api/dashboard/advanced-stats",{headers:t})]);if(!s.ok||!a.ok||!r.ok||!o.ok||!l.ok||!i.ok)throw Error("Failed to fetch dashboard data");let[n,c,d,u,h,g]=await Promise.all([s.json(),a.json(),r.json(),o.json(),l.json(),i.json()]),x={...n,userGrowth:g.userGrowth,activityChange:g.activityChange,scoreChange:g.scoreChange};j({userStats:x,usersByLevel:c,topicPopularity:d,userActivity:u,completionRates:h,weeklyActivity:g.weeklyActivity,trendForecast:g.trendForecast})}catch(e){console.error("Error fetching dashboard data:",e),U("שגיאה בטעינת נתוני הדשבורד. אנא נסה שוב מאוחר יותר.")}finally{R(!1)}})()},[F,O,C]);let K=async e=>{try{let t=localStorage.getItem("token"),s=await fetch("/api/dashboard/export?format=".concat(e),{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});if(!s.ok)throw Error("Failed to export data");if("csv"===e){let e=await s.blob(),t=window.URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="dashboard-export-".concat(new Date().toISOString().split("T")[0],".csv"),document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(t)}else{let e=await s.json(),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=window.URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download="dashboard-export-".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(a)}}catch(e){console.error("Error exporting data:",e),U("שגיאה בייצוא הנתונים. אנא נסה שוב.")}};if(z||I)return(0,a.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,a.jsx)(b.A,{className:"h-8 w-8 animate-spin text-blue-500"})});if(P)return(0,a.jsx)("div",{className:"max-w-7xl mx-auto p-8",children:(0,a.jsx)(L,{message:P})});if(!F)return null;let W=["#0088FE","#00C49F","#FFBB28","#FF8042","#8B5CF6"];return(0,a.jsx)("div",{className:"min-h-screen bg-gray-100 p-8",dir:"rtl",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"דשבורד ניתוח משתמשים"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"ניתוח מקיף של פעילות המשתמשים במערכת"})]}),(0,a.jsx)("div",{className:"flex gap-4 items-center",children:(0,a.jsx)(E(),{href:"/topics",className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-all duration-300",children:"חזור לעמוד הראשי"})})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-md p-4 mb-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)("select",{value:O,onChange:e=>_(e.target.value),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"all",children:"כל הנושאים"}),(0,a.jsx)("option",{value:"Diplomacy and International Relations",children:"Diplomacy and International Relations"}),(0,a.jsx)("option",{value:"Economy and Entrepreneurship",children:"Economy and Entrepreneurship"}),(0,a.jsx)("option",{value:"Environment and Sustainability",children:"Environment and Sustainability"}),(0,a.jsx)("option",{value:"History and Heritage",children:"History and Heritage"}),(0,a.jsx)("option",{value:"Holocaust and Revival",children:"Holocaust and Revival"}),(0,a.jsx)("option",{value:"Innovation and Technology",children:"Innovation and Technology"}),(0,a.jsx)("option",{value:"Iron Swords War",children:"Iron Swords War"}),(0,a.jsx)("option",{value:"Science and Technology",children:"Science and Technology"}),(0,a.jsx)("option",{value:"Society and Multiculturalism",children:"Society and Multiculturalism"})]}),(0,a.jsxs)("select",{value:C,onChange:e=>D(e.target.value),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"7d",children:"7 ימים"}),(0,a.jsx)("option",{value:"30d",children:"30 ימים"}),(0,a.jsx)("option",{value:"90d",children:"90 ימים"}),(0,a.jsx)("option",{value:"1y",children:"שנה"})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{onClick:()=>K("json"),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all duration-300 flex items-center gap-2",children:[(0,a.jsx)(w.A,{className:"h-4 w-4"}),"ייצוא JSON"]}),(0,a.jsxs)("button",{onClick:()=>K("csv"),className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-all duration-300 flex items-center gap-2",children:[(0,a.jsx)(w.A,{className:"h-4 w-4"}),"ייצוא CSV"]})]})]})}),(null==s?void 0:s.userStats)&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,a.jsx)(T,{title:"סה״כ משתמשים",value:(null==(e=s.userStats.totalUsers)?void 0:e.toLocaleString())||"0",icon:N.A,change:s.userStats.userGrowth,changeType:s.userStats.userGrowth>=0?"positive":"negative"}),(0,a.jsx)(T,{title:"משתמשים פעילים",value:(null==(t=s.userStats.activeUsers)?void 0:t.toLocaleString())||"0",icon:S.A,change:s.userStats.activityChange,changeType:s.userStats.activityChange>=0?"positive":"negative"}),(0,a.jsx)(T,{title:"משתמשים חדשים החודש",value:String(s.userStats.newUsersThisMonth||0),icon:k.A,change:s.userStats.newUserGrowth,changeType:s.userStats.newUserGrowth>=0?"positive":"negative"}),(0,a.jsx)(T,{title:"ציון ממוצע",value:String(s.userStats.averageScore||0),icon:A.A,change:s.userStats.scoreChange,changeType:s.userStats.scoreChange>=0?"positive":"negative"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[(null==s?void 0:s.usersByLevel)&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"הפלגת משתמשים לפי רמה"}),(0,a.jsx)("div",{className:"h-80",children:(0,a.jsx)(i.u,{width:"100%",height:"100%",children:(0,a.jsxs)(n.r,{children:[(0,a.jsx)(c.F,{data:s.usersByLevel,cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{name:t,value:s}=e;return"".concat(t,": ").concat(s,"%")},outerRadius:80,fill:"#8884d8",dataKey:"value",children:s.usersByLevel.map((e,t)=>(0,a.jsx)(d.f,{fill:W[t%W.length]},"cell-".concat(t)))}),(0,a.jsx)(u.m,{})]})})})]}),(null==s?void 0:s.topicPopularity)&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"פופולריות נושאים"}),(0,a.jsx)("div",{className:"h-80",children:(0,a.jsx)(i.u,{width:"100%",height:"100%",children:(0,a.jsxs)(h.E,{data:s.topicPopularity,children:[(0,a.jsx)(g.d,{strokeDasharray:"3 3"}),(0,a.jsx)(x.W,{dataKey:"TopicHe"}),(0,a.jsx)(m.h,{}),(0,a.jsx)(u.m,{formatter:(e,t)=>[e,"total_tasks"===t?"משימות":"השלמות"]}),(0,a.jsx)(p.s,{formatter:e=>"total_tasks"===e?"משימות":"השלמות"}),(0,a.jsx)(y.y,{dataKey:"total_tasks",fill:"#8884d8"}),(0,a.jsx)(y.y,{dataKey:"completed_tasks",fill:"#82ca9d"})]})})})]})]}),(null==s?void 0:s.userActivity)&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"פעילות משתמשים לאורך זמן"}),(0,a.jsx)("div",{className:"h-96",children:(0,a.jsx)(i.u,{width:"100%",height:"100%",children:(0,a.jsxs)(v.b,{data:s.userActivity,children:[(0,a.jsx)(g.d,{strokeDasharray:"3 3"}),(0,a.jsx)(x.W,{dataKey:"date"}),(0,a.jsx)(m.h,{}),(0,a.jsx)(u.m,{}),(0,a.jsx)(p.s,{formatter:e=>"activities"===e?"פעילויות":"משתמשים פעילים"}),(0,a.jsx)(f.N,{type:"monotone",dataKey:"activities",stroke:"#8884d8",strokeWidth:2}),(0,a.jsx)(f.N,{type:"monotone",dataKey:"active_users",stroke:"#82ca9d",strokeWidth:2})]})})})]}),(null==s?void 0:s.weeklyActivity)&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"פעילות שבועית"}),(0,a.jsx)("div",{className:"h-80",children:(0,a.jsx)(i.u,{width:"100%",height:"100%",children:(0,a.jsxs)(h.E,{data:s.weeklyActivity,children:[(0,a.jsx)(g.d,{strokeDasharray:"3 3"}),(0,a.jsx)(x.W,{dataKey:"day_name"}),(0,a.jsx)(m.h,{}),(0,a.jsx)(u.m,{}),(0,a.jsx)(p.s,{formatter:e=>"activities"===e?"פעילויות":"ציון ממוצע"}),(0,a.jsx)(y.y,{dataKey:"activities",fill:"#8884d8"}),(0,a.jsx)(y.y,{dataKey:"avg_score",fill:"#82ca9d"})]})})})]}),(null==s?void 0:s.completionRates)&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"שיעור השלמה לפי סוג פעילות"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:s.completionRates.map((e,t)=>(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsxs)("div",{className:"relative w-24 h-24 mb-2",children:[(0,a.jsxs)("svg",{className:"w-full h-full transform -rotate-90",children:[(0,a.jsx)("circle",{cx:"48",cy:"48",r:"40",stroke:"#E5E7EB",strokeWidth:"8",fill:"none"}),(0,a.jsx)("circle",{cx:"48",cy:"48",r:"40",stroke:W[t%W.length],strokeWidth:"8",fill:"none",strokeDasharray:"".concat(2*Math.PI*40),strokeDashoffset:"".concat(2*Math.PI*40*(1-e.rate/100)),strokeLinecap:"round"})]}),(0,a.jsxs)("span",{className:"absolute inset-0 flex items-center justify-center text-xl font-bold",children:[e.rate,"%"]})]}),(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-700",children:e.name})]},t))})]}),(null==s?void 0:s.topicPopularity)&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"נושאים מובילים לפי ציון ממוצע"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"נושא"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"משימות"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"השלמות"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ציון ממוצע"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.topicPopularity.sort((e,t)=>t.avg_score-e.avg_score).map((e,t)=>(0,a.jsxs)("tr",{className:t%2==0?"bg-white":"bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.TopicHe||e.TopicName}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.total_tasks}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.completed_tasks}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,a.jsxs)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(e.avg_score>=80?"bg-green-100 text-green-800":e.avg_score>=70?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:["number"==typeof e.avg_score?e.avg_score.toFixed(1):"0","                          "]})})]},t))})]})})]}),(null==s?void 0:s.trendForecast)&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"מגמות פעילות - 30 ימים אחרונים"}),(0,a.jsx)("div",{className:"h-80",children:(0,a.jsx)(i.u,{width:"100%",height:"100%",children:(0,a.jsxs)(v.b,{data:s.trendForecast,children:[(0,a.jsx)(g.d,{strokeDasharray:"3 3"}),(0,a.jsx)(x.W,{dataKey:"activity_date"}),(0,a.jsx)(m.h,{}),(0,a.jsx)(u.m,{}),(0,a.jsx)(p.s,{formatter:e=>"daily_activities"===e?"פעילויות יומיות":"משתמשים ייחודיים"}),(0,a.jsx)(f.N,{type:"monotone",dataKey:"daily_activities",stroke:"#8884d8",strokeWidth:2}),(0,a.jsx)(f.N,{type:"monotone",dataKey:"unique_users",stroke:"#82ca9d",strokeWidth:2})]})})})]})]})})};function P(){let{isAuthenticated:e,isLoading:t,user:s}=(0,o.A)(),i=(0,l.useRouter)();return((0,r.useEffect)(()=>{console.log("Dashboard Page - Auth State:",{isAuthenticated:e,isLoading:t,user:s,role:null==s?void 0:s.role,UserRole:null==s?void 0:s.UserRole}),t||(e?(null==s?void 0:s.role)!=="admin"&&(null==s?void 0:s.UserRole)!=="admin"&&(console.log("Not admin, redirecting to topics"),i.push("/topics")):(console.log("Not authenticated, redirecting to login"),i.push("/login")))},[e,t,s,i]),t)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e&&((null==s?void 0:s.role)==="admin"||(null==s?void 0:s.UserRole)==="admin")?(0,a.jsx)(R,{}):(console.log("Not rendering dashboard - Auth check failed:",{isAuthenticated:e,role:null==s?void 0:s.role,UserRole:null==s?void 0:s.UserRole}),null)}},40823:(e,t,s)=>{Promise.resolve().then(s.bind(s,5615))},41008:(e,t,s)=>{"use strict";s.d(t,{Av:()=>l,Ly:()=>h,bZ:()=>i,e$:()=>u,kV:()=>c,l6:()=>d,zG:()=>n});let a=s(49509).env.NEXT_PUBLIC_API_URL;async function r(e){let t=e.headers.get("content-type");if(console.log("Response status: ".concat(e.status,", Content-Type: ").concat(t)),t&&t.includes("application/json"))try{let t=await e.json();if(!e.ok){let s={status:e.status,statusText:e.statusText,message:t.message||t.error||"API request failed",responseData:t,url:e.url};throw console.error("API Error (JSON):",s),s}return t}catch(t){if(!e.ok){let s={status:e.status,statusText:e.statusText,message:"Failed to parse JSON response: ".concat(t),responseData:null,url:e.url};throw console.error("API Error (JSON Parse Failed):",s),s}throw t}try{let t=await e.text();if(console.log("Response text (first 200 chars): ".concat(t.substring(0,200))),!e.ok){let s={status:e.status,statusText:e.statusText,message:t||"API request failed",responseData:t,url:e.url};throw console.error("API Error (Text):",s),s}return t}catch(s){let t={status:e.status,statusText:e.statusText,message:"Failed to read response: ".concat(s),responseData:null,url:e.url};throw console.error("API Error (Text Read Failed):",t),t}}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s={"Content-Type":"application/json",...t.headers},o="".concat(a).concat(e);console.log("Making API call to: ".concat(o));try{let e=await fetch(o,{...t,headers:s,credentials:"include"});return await r(e)}catch(t){throw console.error("API call failed for ".concat(e,":"),{url:o,error:t,errorMessage:t instanceof Error?t.message:"Unknown error",errorStack:t instanceof Error?t.stack:void 0,headers:s}),t&&"object"==typeof t&&(t.endpoint=e,t.fullUrl=o),t}}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o(e,t)}async function i(){return o("/health")}let n={login:async e=>o("/auth/login",{method:"POST",body:JSON.stringify(e)}),register:async e=>o("/auth/register",{method:"POST",body:JSON.stringify(e)}),validate:async()=>o("/auth/validate",{method:"POST",body:JSON.stringify({})}),logout:async()=>o("/auth/logout",{method:"POST"})},c={getProfile:async()=>o("/user/profile"),updateProfile:async e=>o("/user/profile",{method:"PUT",body:JSON.stringify(e)}),getData:async()=>o("/user/data")},d={getAll:async()=>o("/topics"),getById:async e=>o("/topics/".concat(e)),getUserProgress:async()=>o("/topics/progress")},u={create:async e=>o("/tasks",{method:"POST",body:JSON.stringify(e)}),getById:async e=>o("/tasks/".concat(e)),update:async(e,t)=>o("/tasks/".concat(e),{method:"PUT",body:JSON.stringify(t)}),getUserTasks:async e=>o("/tasks/user/".concat(e))},h={getByTopicAndLevel:async(e,t)=>{try{console.log('\uD83D\uDE80 Fetching flashcards: topic="'.concat(e,'", level="').concat(t,'"'));let s=await o("/flashcards/".concat(encodeURIComponent(e),"/").concat(t));if(s&&s.success)return console.log("✅ Received ".concat(s.data.length," unlearned flashcards")),s.data;if(Array.isArray(s))return console.log("✅ Received ".concat(s.length," unlearned flashcards (direct array)")),s;throw console.error("❌ Unexpected response format:",s),Error("Invalid response format from flashcards API")}catch(e){throw console.error("❌ Error fetching flashcards:",e),e}},create:async e=>o("/flashcards",{method:"POST",body:JSON.stringify(e)}),markAsLearned:async(e,t,s)=>o("/flashcards/mark-learned",{method:"POST",body:JSON.stringify({WordId:e,TaskId:t,TopicName:s})})}},66681:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var a=s(12115),r=s(41008);let o=[],l={isAuthenticated:!1,isLoading:!0,user:null,error:null,isInitialized:!1},i=e=>{l=e,o.forEach(t=>t(e))},n=()=>{let[e,t]=(0,a.useState)(l);(0,a.useEffect)(()=>{let e=e=>{t(e)};return o.push(e),()=>{o=o.filter(t=>t!==e)}},[]);let s=(0,a.useCallback)(e=>{t(e),i(e)},[]),n=(0,a.useCallback)(async()=>{console.log("\uD83D\uDD0D Starting auth validation...");try{let e=await r.zG.validate();if(console.log("\uD83D\uDCE1 Validation response:",e),!e.valid&&!e.success)return localStorage.removeItem("user"),s({isAuthenticated:!1,isLoading:!1,user:null,error:e.message||"Authentication failed",isInitialized:!0}),!1;{let t=e.user;if(!t||!t.role&&!t.UserRole){let e=localStorage.getItem("user");if(e)try{t={...JSON.parse(e),...t}}catch(e){console.error("Error parsing stored user data:",e)}}return t&&(t={...t,role:t.role||t.UserRole||"user",UserRole:t.UserRole||t.role||"user"}),s({isAuthenticated:!0,isLoading:!1,user:t,error:null,isInitialized:!0}),!0}}catch(t){console.error("Auth validation error:",t);let e=localStorage.getItem("user");if(e)try{let t=JSON.parse(e);return s({isAuthenticated:!0,isLoading:!1,user:t,error:null,isInitialized:!0}),!0}catch(e){console.error("Error parsing stored user data:",e)}return localStorage.removeItem("user"),s({isAuthenticated:!1,isLoading:!1,user:null,error:t instanceof Error?t.message:"Authentication error",isInitialized:!0}),!1}},[s]);(0,a.useEffect)(()=>{n()},[n]);let c=async function(t,a){arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{console.log("\uD83D\uDD10 Starting login process..."),s({...e,isLoading:!0});let o=await r.zG.login({email:t,password:a});if(console.log("\uD83D\uDCE1 Login response:",o),!o.success)return s({isAuthenticated:!1,isLoading:!1,user:null,error:o.message||"Login failed",isInitialized:!0}),{success:!1,message:o.message||"Login failed"};{let e=o.user||{email:t},a={...e,role:(null==e?void 0:e.role)||(null==e?void 0:e.UserRole)||"user",UserRole:(null==e?void 0:e.UserRole)||(null==e?void 0:e.role)||"user"};return localStorage.setItem("user",JSON.stringify(a)),s({isAuthenticated:!0,isLoading:!1,user:a,error:null,isInitialized:!0}),{success:!0}}}catch(t){if(console.error("❌ Login error:",t),t.responseData){let e=t.responseData.message||t.message||"Login failed";return console.log("API Error details:",t.responseData),s({isAuthenticated:!1,isLoading:!1,user:null,error:e,isInitialized:!0}),{success:!1,message:e,details:t.responseData.details}}let e=t instanceof Error?t.message:"An unexpected error occurred";return s({isAuthenticated:!1,isLoading:!1,user:null,error:e,isInitialized:!0}),{success:!1,message:e}}},d=async()=>{console.log("\uD83D\uDC4B Logging out...");try{await r.zG.logout()}catch(e){console.error("Logout API call failed:",e)}localStorage.removeItem("user"),s({isAuthenticated:!1,isLoading:!1,user:null,error:null,isInitialized:!0})};return{...e,login:c,logout:d,validateAuth:n}}}},e=>{var t=t=>e(e.s=t);e.O(0,[6874,6797,8441,1684,7358],()=>t(40823)),_N_E=e.O()}]);