(()=>{var e={};e.id=6456,e.ids=[6456],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10722:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>v,routeModule:()=>f,serverHooks:()=>j,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>y});var s={};r.r(s),r.d(s,{GET:()=>h,POST:()=>k,PUT:()=>g});var o=r(96559),n=r(48088),a=r(37719),i=r(32190),u=r(43205),c=r.n(u),l=r(23725);let d=process.env.API_URL||"https://unity-voice-api-linux-f2hsapgsh3hcgqc0.israelcentral-01.azurewebsites.net/api";function p(e){try{let t=e.headers.get("authorization");if(!t||!t.startsWith("Bearer "))return{userId:null,error:"No valid authorization header"};let r=t.split(" ")[1],s=process.env.JWT_SECRET;if(!s)return console.error("JWT secret is not defined"),{userId:null,error:"JWT secret not configured"};let o=c().verify(r,s),n=o.userId||o.id?.toString()||null;if(!n)return{userId:null,error:"No userId found in token"};return console.log("✅ Extracted userId from token:",n),{userId:n}}catch(e){return console.error("❌ Error extracting userId from token:",e),{userId:null,error:"Invalid token"}}}async function k(e){try{console.log("\uD83D\uDCCB API Tasks - Creating task");let{userId:t,error:r}=p(e);if(!t)return console.error("Authentication failed:",r),i.NextResponse.json({success:!1,error:`Authentication required: ${r}`},{status:401});let s=await e.json();console.log("\uD83D\uDCDD Original request body:",JSON.stringify(s,null,2));let o={...s,UserId:t};console.log("\uD83D\uDCDD Request body with UserId:",JSON.stringify(o,null,2));let n=e.headers.get("Authorization"),a=`${d}/tasks`;console.log("\uD83D\uDE80 Proxying task creation request to:",a);let u=await (0,l.v)(a,{method:"POST",headers:{Authorization:n||"","Content-Type":"application/json"},body:JSON.stringify(o)});if(console.log("\uD83D\uDCE1 Backend response status:",u.status),!u.ok){let e,t=await u.text();console.error("❌ Backend tasks API error:",t);try{e=JSON.parse(t)}catch{e={error:"Failed to create task in backend",details:t}}return i.NextResponse.json(e,{status:u.status})}let c=await u.json();return console.log("✅ Task created successfully:",c),i.NextResponse.json(c)}catch(e){return console.error("\uD83D\uDCA5 Error in task creation:",e),i.NextResponse.json({success:!1,error:"Internal server error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function g(e){try{console.log("\uD83D\uDCDD API Tasks - Updating task");let{userId:t,error:r}=p(e);if(!t)return console.error("Authentication failed:",r),i.NextResponse.json({success:!1,error:`Authentication required: ${r}`},{status:401});let s=await e.json(),o=s.taskId||s.TaskId;if(!o)return i.NextResponse.json({success:!1,error:"Task ID is required"},{status:400});console.log("\uD83D\uDCDD Update request body:",JSON.stringify(s,null,2));let n=e.headers.get("Authorization"),a=`${d}/tasks/${o}`;console.log("\uD83D\uDE80 Proxying task update request to:",a);let u=await (0,l.v)(a,{method:"PATCH",headers:{Authorization:n||"","Content-Type":"application/json"},body:JSON.stringify(s)});if(console.log("\uD83D\uDCE1 Backend response status:",u.status),!u.ok){let e,t=await u.text();console.error("❌ Backend task update API error:",t);try{e=JSON.parse(t)}catch{e={error:"Failed to update task in backend",details:t}}return i.NextResponse.json(e,{status:u.status})}let c=await u.json();return console.log("✅ Task updated successfully:",c),i.NextResponse.json(c)}catch(e){return console.error("\uD83D\uDCA5 Error in task update:",e),i.NextResponse.json({success:!1,error:"Internal server error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function h(e){try{console.log("\uD83D\uDCCB API Tasks - Getting user tasks");let{userId:t,error:r}=p(e);if(!t)return console.error("Authentication failed:",r),i.NextResponse.json({success:!1,error:`Authentication required: ${r}`},{status:401});let s=e.headers.get("Authorization"),{searchParams:o}=new URL(e.url),n=o.toString(),a=`${d}/tasks${n?`?${n}`:""}`;console.log("\uD83D\uDE80 Proxying get tasks request to:",a);let u=await (0,l.v)(a,{method:"GET",headers:{Authorization:s||"","Content-Type":"application/json"}});if(console.log("\uD83D\uDCE1 Backend response status:",u.status),!u.ok){let e,t=await u.text();console.error("❌ Backend get tasks API error:",t);try{e=JSON.parse(t)}catch{e={error:"Failed to fetch tasks from backend",details:t}}return i.NextResponse.json(e,{status:u.status})}let c=await u.json();return console.log(`✅ Tasks retrieved successfully: ${Array.isArray(c)?c.length:"unknown"} tasks`),i.NextResponse.json(c)}catch(e){return console.error("\uD83D\uDCA5 Error in get tasks:",e),i.NextResponse.json({success:!1,error:"Internal server error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}console.log("\uD83D\uDD0D API_URL value:",d);let f=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/tasks/route",pathname:"/api/tasks",filename:"route",bundlePath:"app/api/tasks/route"},resolvedPagePath:"C:\\Projects\\110625\\unity-voice-frontend\\src\\app\\api\\tasks\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:x,workUnitAsyncStorage:y,serverHooks:j}=f;function v(){return(0,a.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:y})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},23725:(e,t,r)=>{"use strict";async function s(e,t={}){return fetch(e,{credentials:"include",headers:{"Content-Type":"application/json",...t.headers||{}},...t})}r.d(t,{v:()=>s})},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[7719,580,3205],()=>r(10722));module.exports=s})();