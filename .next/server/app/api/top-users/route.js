(()=>{var e={};e.id=5304,e.ids=[5304],e.modules={3111:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>g,routeModule:()=>p,serverHooks:()=>f,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>x});var s={};t.r(s),t.d(s,{GET:()=>l});var o=t(96559),n=t(48088),a=t(37719),u=t(32190),c=t(4160),i=t(12909);async function l(e){try{let r=e.headers.get("authorization");if(!r||!r.startsWith("Bearer "))return u.NextResponse.json({message:"לא מורשה"},{status:401});let t=r.split(" ")[1];if(!(0,i.bw)(t))return u.NextResponse.json({message:"טוקן לא תקף"},{status:401});let s=`
      SELECT 
        u.UserId, 
        u.FirstName, 
        u.LastName, 
        u.Score, 
        u.ProfilePicture,
        @rank := @rank + 1 AS UserRank
      FROM 
        users u, 
        (SELECT @rank := 0) r
      WHERE 
        u.IsActive = 1
      ORDER BY 
        u.Score DESC
      LIMIT 5
    `,o=await (0,c.eW)(s,[],"Fetch top users");if(!o.success)return console.error("Database query failed:",o.error),u.NextResponse.json({message:"שגיאה בשאילתת מסד הנתונים"},{status:500});return u.NextResponse.json(o.result)}catch(e){return console.error("Error fetching top users:",e),u.NextResponse.json({message:"שגיאה בלתי צפויה במהלך שליפת המשתמשים המובילים"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/top-users/route",pathname:"/api/top-users",filename:"route",bundlePath:"app/api/top-users/route"},resolvedPagePath:"C:\\Users\\orzil\\OneDrive\\שולחן העבודה\\070525\\unity-voice-frontend-1\\src\\app\\api\\top-users\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:x,serverHooks:f}=p;function g(){return(0,a.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:x})}},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4160:(e,r,t)=>{"use strict";t.d(r,{eW:()=>n});var s=t(46101);async function o(){try{let e=process.env.DB_HOST||process.env.MYSQL_HOST||"localhost",r=process.env.DB_USER||process.env.MYSQL_USER||"root",t=process.env.DB_PASSWORD||process.env.MYSQL_PASSWORD||"",o=process.env.DB_NAME||process.env.MYSQL_DATABASE||"unityvoice",n="true"===process.env.DB_SSL||"true"===process.env.MYSQL_SSL;console.log(`Attempting to connect to MySQL database: ${r}@${e}/${o}`);let a=await s.createConnection({host:e,user:r,password:t,database:o,ssl:n?{rejectUnauthorized:!1}:void 0}),[u]=await a.execute("SELECT 1 as test");return console.log("Database connection successful, test query result:",u),a}catch(e){return console.error("Error creating direct database connection:",e),null}}async function n(e,r,t){let s=null;try{if(!(s=await o()))throw Error("Failed to establish database connection");console.log(`Executing ${t} query:`,e),console.log("Query parameters:",r);let[n]=await s.execute(e,r);return console.log(`${t} query result:`,JSON.stringify(n)),{success:!0,result:n}}catch(e){return console.error(`Error executing ${t} query:`,e),{success:!1,error:e}}finally{if(s)try{await s.end(),console.log("Database connection closed successfully")}catch(e){console.error("Error closing database connection:",e)}}}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12909:(e,r,t)=>{"use strict";t.d(r,{bw:()=>n});var s=t(43205),o=t.n(s);function n(e){try{if(!e)return null;let r=process.env.JWT_SECRET||"your-fallback-secret";return o().verify(e,r)}catch(e){return console.error("Token verification failed:",e),null}}t(39466)},19771:e=>{"use strict";e.exports=require("process")},27910:e=>{"use strict";e.exports=require("stream")},28303:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=28303,e.exports=r},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39466:(e,r,t)=>{"use strict";let s=process.env.NEXT_PUBLIC_API_URL;async function o(e){let r=e.headers.get("content-type");if(console.log(`Response status: ${e.status}, Content-Type: ${r}`),r&&r.includes("application/json"))try{let r=await e.json();if(!e.ok){let t={status:e.status,statusText:e.statusText,message:r.message||r.error||"API request failed",responseData:r,url:e.url};throw console.error("API Error (JSON):",t),t}return r}catch(r){if(!e.ok){let t={status:e.status,statusText:e.statusText,message:`Failed to parse JSON response: ${r}`,responseData:null,url:e.url};throw console.error("API Error (JSON Parse Failed):",t),t}throw r}try{let r=await e.text();if(console.log(`Response text (first 200 chars): ${r.substring(0,200)}`),!e.ok){let t={status:e.status,statusText:e.statusText,message:r||"API request failed",responseData:r,url:e.url};throw console.error("API Error (Text):",t),t}return r}catch(t){let r={status:e.status,statusText:e.statusText,message:`Failed to read response: ${t}`,responseData:null,url:e.url};throw console.error("API Error (Text Read Failed):",r),r}}async function n(e,r={}){let t={"Content-Type":"application/json",...r.headers},a=`${s}${e}`;console.log(`Making API call to: ${a}`);try{let e=await fetch(a,{...r,headers:t,credentials:"include"});return await o(e)}catch(r){throw console.error(`API call failed for ${e}:`,{url:a,error:r,errorMessage:r instanceof Error?r.message:"Unknown error",errorStack:r instanceof Error?r.stack:void 0,headers:t}),r&&"object"==typeof r&&(r.endpoint=e,r.fullUrl=a),r}}},41204:e=>{"use strict";e.exports=require("string_decoder")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66136:e=>{"use strict";e.exports=require("timers")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[7719,580,3205,6101],()=>t(3111));module.exports=s})();