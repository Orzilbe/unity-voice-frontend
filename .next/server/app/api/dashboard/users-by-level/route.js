(()=>{var e={};e.id=2474,e.ids=[2474],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4160:(e,r,t)=>{"use strict";t.d(r,{eW:()=>a});var s=t(46101);async function o(){try{let e=process.env.DB_HOST||process.env.MYSQL_HOST||"localhost",r=process.env.DB_USER||process.env.MYSQL_USER||"root",t=process.env.DB_PASSWORD||process.env.MYSQL_PASSWORD||"",o=process.env.DB_NAME||process.env.MYSQL_DATABASE||"unityvoice",a="true"===process.env.DB_SSL||"true"===process.env.MYSQL_SSL;console.log(`Attempting to connect to MySQL database: ${r}@${e}/${o}`);let n=await s.createConnection({host:e,user:r,password:t,database:o,ssl:a?{rejectUnauthorized:!1}:void 0}),[u]=await n.execute("SELECT 1 as test");return console.log("Database connection successful, test query result:",u),n}catch(e){return console.error("Error creating direct database connection:",e),null}}async function a(e,r,t){let s=null;try{if(!(s=await o()))throw Error("Failed to establish database connection");console.log(`Executing ${t} query:`,e),console.log("Query parameters:",r);let[a]=await s.execute(e,r);return console.log(`${t} query result:`,JSON.stringify(a)),{success:!0,result:a}}catch(e){return console.error(`Error executing ${t} query:`,e),{success:!1,error:e}}finally{if(s)try{await s.end(),console.log("Database connection closed successfully")}catch(e){console.error("Error closing database connection:",e)}}}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12056:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>f,routeModule:()=>p,serverHooks:()=>x,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>v});var s={};t.r(s),t.d(s,{GET:()=>l});var o=t(96559),a=t(48088),n=t(37719),u=t(32190),c=t(4160),i=t(12909);async function l(e){try{let r=e.headers.get("authorization");if(!r||!r.startsWith("Bearer "))return u.NextResponse.json({message:"לא מורשה"},{status:401});let t=r.split(" ")[1];if(!(0,i.bw)(t))return u.NextResponse.json({message:"טוקן לא תקף"},{status:401});let s=`
      SELECT 
        COALESCE(EnglishLevel, 'לא מוגדר') as level,
        COUNT(*) as users_count,
        ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM users WHERE IsActive = 1), 1) as percentage
      FROM users 
      WHERE IsActive = 1
      GROUP BY EnglishLevel
      ORDER BY users_count DESC
    `,o=await (0,c.eW)(s,[],"Fetch users by level");if(!o.success)return console.error("Database query failed:",o.error),u.NextResponse.json({message:"שגיאה בשאילתת מסד הנתונים"},{status:500});let a={beginner:"מתחיל",intermediate:"בינוני",advanced:"מתקדם","לא מוגדר":"לא מוגדר"},n=o.result?.map(e=>({name:a[e.level]||e.level,value:parseFloat(e.percentage),users:e.users_count}))||[];return u.NextResponse.json(n)}catch(e){return console.error("Error fetching users by level:",e),u.NextResponse.json({message:"שגיאה בלתי צפויה"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/dashboard/users-by-level/route",pathname:"/api/dashboard/users-by-level",filename:"route",bundlePath:"app/api/dashboard/users-by-level/route"},resolvedPagePath:"C:\\Users\\orzil\\OneDrive\\שולחן העבודה\\070525\\unity-voice-frontend-1\\src\\app\\api\\dashboard\\users-by-level\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:v,serverHooks:x}=p;function f(){return(0,n.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:v})}},12909:(e,r,t)=>{"use strict";t.d(r,{bw:()=>a});var s=t(43205),o=t.n(s);function a(e){try{if(!e)return null;let r=process.env.JWT_SECRET||"your-fallback-secret";return o().verify(e,r)}catch(e){return console.error("Token verification failed:",e),null}}t(39466)},19771:e=>{"use strict";e.exports=require("process")},27910:e=>{"use strict";e.exports=require("stream")},28303:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=28303,e.exports=r},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39466:(e,r,t)=>{"use strict";let s=process.env.NEXT_PUBLIC_API_URL;async function o(e){let r=e.headers.get("content-type");if(console.log(`Response status: ${e.status}, Content-Type: ${r}`),r&&r.includes("application/json"))try{let r=await e.json();if(!e.ok){let t={status:e.status,statusText:e.statusText,message:r.message||r.error||"API request failed",responseData:r,url:e.url};throw console.error("API Error (JSON):",t),t}return r}catch(r){if(!e.ok){let t={status:e.status,statusText:e.statusText,message:`Failed to parse JSON response: ${r}`,responseData:null,url:e.url};throw console.error("API Error (JSON Parse Failed):",t),t}throw r}try{let r=await e.text();if(console.log(`Response text (first 200 chars): ${r.substring(0,200)}`),!e.ok){let t={status:e.status,statusText:e.statusText,message:r||"API request failed",responseData:r,url:e.url};throw console.error("API Error (Text):",t),t}return r}catch(t){let r={status:e.status,statusText:e.statusText,message:`Failed to read response: ${t}`,responseData:null,url:e.url};throw console.error("API Error (Text Read Failed):",r),r}}async function a(e,r={}){let t={"Content-Type":"application/json",...r.headers},n=`${s}${e}`;console.log(`Making API call to: ${n}`);try{let e=await fetch(n,{...r,headers:t,credentials:"include"});return await o(e)}catch(r){throw console.error(`API call failed for ${e}:`,{url:n,error:r,errorMessage:r instanceof Error?r.message:"Unknown error",errorStack:r instanceof Error?r.stack:void 0,headers:t}),r&&"object"==typeof r&&(r.endpoint=e,r.fullUrl=n),r}}},41204:e=>{"use strict";e.exports=require("string_decoder")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66136:e=>{"use strict";e.exports=require("timers")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[7719,580,3205,6101],()=>t(12056));module.exports=s})();