"use strict";(()=>{var e={};e.id=2474,e.ids=[2474],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19771:e=>{e.exports=require("process")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{e.exports=require("tls")},39803:(e,r,s)=>{s.r(r),s.d(r,{patchFetch:()=>g,routeModule:()=>d,serverHooks:()=>v,workAsyncStorage:()=>c,workUnitAsyncStorage:()=>x});var t={};s.r(t),s.d(t,{GET:()=>l});var o=s(96559),a=s(48088),n=s(37719),u=s(32190),i=s(4160),p=s(12909);async function l(e){try{let r=e.headers.get("authorization");if(!r||!r.startsWith("Bearer "))return u.NextResponse.json({message:"לא מורשה"},{status:401});let s=r.split(" ")[1];if(!(0,p.bw)(s))return u.NextResponse.json({message:"טוקן לא תקף"},{status:401});let t=`
      SELECT 
        COALESCE(EnglishLevel, 'לא מוגדר') as level,
        COUNT(*) as users_count,
        ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM users WHERE IsActive = 1), 1) as percentage
      FROM users 
      WHERE IsActive = 1
      GROUP BY EnglishLevel
      ORDER BY users_count DESC
    `,o=await (0,i.eW)(t,[],"Fetch users by level");if(!o.success)return console.error("Database query failed:",o.error),u.NextResponse.json({message:"שגיאה בשאילתת מסד הנתונים"},{status:500});let a={beginner:"מתחיל",intermediate:"בינוני",advanced:"מתקדם","לא מוגדר":"לא מוגדר"},n=o.result?.map(e=>({name:a[e.level]||e.level,value:parseFloat(e.percentage),users:e.users_count}))||[];return u.NextResponse.json(n)}catch(e){return console.error("Error fetching users by level:",e),u.NextResponse.json({message:"שגיאה בלתי צפויה"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/dashboard/users-by-level/route",pathname:"/api/dashboard/users-by-level",filename:"route",bundlePath:"app/api/dashboard/users-by-level/route"},resolvedPagePath:"C:\\Projects\\100625\\unity-voice-frontend\\src\\app\\api\\dashboard\\users-by-level\\route.ts",nextConfigOutput:"",userland:t}),{workAsyncStorage:c,workUnitAsyncStorage:x,serverHooks:v}=d;function g(){return(0,n.patchFetch)({workAsyncStorage:c,workUnitAsyncStorage:x})}},41204:e=>{e.exports=require("string_decoder")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66136:e=>{e.exports=require("timers")},74075:e=>{e.exports=require("zlib")},79428:e=>{e.exports=require("buffer")},79551:e=>{e.exports=require("url")},91645:e=>{e.exports=require("net")},94735:e=>{e.exports=require("events")}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[7719,580,3205,6101,1208],()=>s(39803));module.exports=t})();