(()=>{var e={};e.id=4398,e.ids=[4398],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4160:(e,t,r)=>{"use strict";r.d(t,{eW:()=>a});var s=r(46101);async function o(){try{let e=process.env.DB_HOST||process.env.MYSQL_HOST||"localhost",t=process.env.DB_USER||process.env.MYSQL_USER||"root",r=process.env.DB_PASSWORD||process.env.MYSQL_PASSWORD||"",o=process.env.DB_NAME||process.env.MYSQL_DATABASE||"unityvoice",a="true"===process.env.DB_SSL||"true"===process.env.MYSQL_SSL;console.log(`Attempting to connect to MySQL database: ${t}@${e}/${o}`);let n=await s.createConnection({host:e,user:t,password:r,database:o,ssl:a?{rejectUnauthorized:!1}:void 0}),[i]=await n.execute("SELECT 1 as test");return console.log("Database connection successful, test query result:",i),n}catch(e){return console.error("Error creating direct database connection:",e),null}}async function a(e,t,r){let s=null;try{if(!(s=await o()))throw Error("Failed to establish database connection");console.log(`Executing ${r} query:`,e),console.log("Query parameters:",t);let[a]=await s.execute(e,t);return console.log(`${r} query result:`,JSON.stringify(a)),{success:!0,result:a}}catch(e){return console.error(`Error executing ${r} query:`,e),{success:!1,error:e}}finally{if(s)try{await s.end(),console.log("Database connection closed successfully")}catch(e){console.error("Error closing database connection:",e)}}}},8891:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>y,routeModule:()=>p,serverHooks:()=>f,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{GET:()=>l});var o=r(96559),a=r(48088),n=r(37719),i=r(32190),c=r(4160),u=r(12909);async function l(e){try{let t=e.headers.get("authorization");if(!t||!t.startsWith("Bearer "))return i.NextResponse.json({message:"לא מורשה"},{status:401});let r=t.split(" ")[1];if(!(0,u.bw)(r))return i.NextResponse.json({message:"טוקן לא תקף"},{status:401});let{searchParams:s}=new URL(e.url),o=s.get("topic")||"all",a=`
      SELECT 
        t.TopicName,
        t.TopicHe,
        COUNT(DISTINCT task.TaskId) as total_tasks,
        COUNT(task.CompletionDate) as completed_tasks,
        ROUND(AVG(task.TaskScore), 1) as avg_score
      FROM topics t
      LEFT JOIN tasks task ON t.TopicName = task.TopicName
    `;"all"!==o&&(a+=" WHERE t.TopicName = ?"),a+=`
      GROUP BY t.TopicName, t.TopicHe
      ORDER BY completed_tasks DESC
      LIMIT 10
    `;let n=await (0,c.eW)(a,"all"!==o?[o]:[],"Fetch topic popularity");if(!n.success)return console.error("Database query failed:",n.error),i.NextResponse.json({message:"שגיאה בשאילתת מסד הנתונים"},{status:500});return i.NextResponse.json(n.result)}catch(e){return console.error("Error fetching topic popularity:",e),i.NextResponse.json({message:"שגיאה בלתי צפויה"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/dashboard/topic-popularity/route",pathname:"/api/dashboard/topic-popularity",filename:"route",bundlePath:"app/api/dashboard/topic-popularity/route"},resolvedPagePath:"C:\\Users\\orzil\\OneDrive\\שולחן העבודה\\070525\\unity-voice-frontend-1\\src\\app\\api\\dashboard\\topic-popularity\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:x,serverHooks:f}=p;function y(){return(0,n.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:x})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12909:(e,t,r)=>{"use strict";r.d(t,{bw:()=>a});var s=r(43205),o=r.n(s);function a(e){try{if(!e)return null;let t=process.env.JWT_SECRET||"your-fallback-secret";return o().verify(e,t)}catch(e){return console.error("Token verification failed:",e),null}}r(39466)},19771:e=>{"use strict";e.exports=require("process")},27910:e=>{"use strict";e.exports=require("stream")},28303:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=28303,e.exports=t},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39466:(e,t,r)=>{"use strict";let s=process.env.NEXT_PUBLIC_API_URL;async function o(e){let t=e.headers.get("content-type");if(console.log(`Response status: ${e.status}, Content-Type: ${t}`),t&&t.includes("application/json"))try{let t=await e.json();if(!e.ok){let r={status:e.status,statusText:e.statusText,message:t.message||t.error||"API request failed",responseData:t,url:e.url};throw console.error("API Error (JSON):",r),r}return t}catch(t){if(!e.ok){let r={status:e.status,statusText:e.statusText,message:`Failed to parse JSON response: ${t}`,responseData:null,url:e.url};throw console.error("API Error (JSON Parse Failed):",r),r}throw t}try{let t=await e.text();if(console.log(`Response text (first 200 chars): ${t.substring(0,200)}`),!e.ok){let r={status:e.status,statusText:e.statusText,message:t||"API request failed",responseData:t,url:e.url};throw console.error("API Error (Text):",r),r}return t}catch(r){let t={status:e.status,statusText:e.statusText,message:`Failed to read response: ${r}`,responseData:null,url:e.url};throw console.error("API Error (Text Read Failed):",t),t}}async function a(e,t={}){let r={"Content-Type":"application/json",...t.headers},n=`${s}${e}`;console.log(`Making API call to: ${n}`);try{let e=await fetch(n,{...t,headers:r,credentials:"include"});return await o(e)}catch(t){throw console.error(`API call failed for ${e}:`,{url:n,error:t,errorMessage:t instanceof Error?t.message:"Unknown error",errorStack:t instanceof Error?t.stack:void 0,headers:r}),t&&"object"==typeof t&&(t.endpoint=e,t.fullUrl=n),t}}},41204:e=>{"use strict";e.exports=require("string_decoder")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66136:e=>{"use strict";e.exports=require("timers")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[7719,580,3205,6101],()=>r(8891));module.exports=s})();